<!DOCTYPE html>
<html data-theme="light" lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#00cbff">
    
    <meta name="description" content="Highlights from the March 2025 release of Chapel 2.4">
    

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css" media="screen,print">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.min.css" integrity="sha384-bYdxxUwYipFNohQlHt0bjN/LCpueqWz13HufFEV1SUatKs1cm4L6fFgCi1jT643X" crossorigin="anonymous">
    
    
    
    
    
    
    <style>.sidenote-checkbox { display: none; }</style>
    <style>.feather { width: 1rem; height: 1rem; }</style>
    <link rel="stylesheet" href="../../scss/style.min.css" media="screen,print">
    <link rel="stylesheet" href="../../scss/sidenotes.min.css" media="screen,print">
    <link rel="stylesheet" href="../../css/syntax.min.css" media="screen,print">
    <link rel="stylesheet" href="../../scss/syntax-terminal.min.css" media="screen,print">
    <link rel="stylesheet" href="../../scss/code.min.css" media="screen,print">
    <link rel="icon" type="image/png" href="../../img/favicon.ico">

    <script src="../../js/dropdown-menu.js" defer></script>

    <title>Announcing Chapel 2.4!</title>
</head>
<body>
<header>
    
    <div class="container">
        <a class="site-title" href="../../">
            <img alt="Chapel logo" width="50" height="50" src="../../img/logo.png">
            <h1>Chapel Language Blog</h1>
        </a>
    </div>
    <nav id="Header">
        <div class="container">
            <a href="../../about">About</a>
            <a href="https://chapel-lang.org">Chapel Website</a>
            <a href="../../featured">Featured</a>
            <a href="../../series">Series</a>
            <a href="../../tags">Tags</a>
            <a href="../../authors">Authors</a>
            <a href="../../posts">All Posts</a>
        </div>
    </nav>
    
</header>
<main class="container">
<h2>Announcing Chapel 2.4!</h2>
<div class="post-subscript">
    <p>Posted on March 20, 2025.</p>
    <p>
        Tags:
        
        <a class="button" href="../../tags/release-announcements">Release Announcements</a>
        
        <a class="button" href="../../tags/python">Python</a>
        
        <a class="button" href="../../tags/dyno">Dyno</a>
        
    </p>
    <p>
    By:
    <a href="../../authors/brad-chamberlain">Brad Chamberlain</a>, <a href="../../authors/jade-abraham">Jade Abraham</a>, <a href="../../authors/daniel-fedorin">Daniel Fedorin</a>
    </p>
</div>

<div class="post-content">
    
    <div class="table-of-contents">
        <div class="wrapper">
            <span class="header">Table of Contents</span>
            <nav id="TableOfContents">
  <ul>
    <li><a href="#multidimensional-array-literals">Multidimensional Array Literals</a></li>
    <li><a href="#python-interoperability">Python Interoperability</a>
      <ul>
        <li><a href="#ergonomic-improvements">Ergonomic Improvements</a></li>
        <li><a href="#data-type-improvements">Data Type Improvements</a></li>
      </ul>
    </li>
    <li><a href="#chapel-support-for-cmake">Chapel Support for CMake</a></li>
    <li><a href="#dyno-support-for-chapel-features">Dyno Support for Chapel Features</a></li>
    <li><a href="#for-more-information">For More Information</a></li>
  </ul>
</nav>
        </div>
    </div>
    

    

    <p>The Chapel community is happy to announce the release of Chapel 2.4!
In this article, we&rsquo;ll summarize some of its main highlights,
including:</p>
<ul>
<li>
<p>Brand-new syntax for defining <a href="#multidimensional-array-literals">multidimensional array
values</a></p>
</li>
<li>
<p>Significant improvements in <a href="#python-interoperability">Chapel-Python
interoperability</a></p>
</li>
<li>
<p>Support for building Chapel programs <a href="#chapel-support-for-cmake">with
CMake</a></p>
</li>
<li>
<p>Significant advances in <a href="#dyno-support-for-chapel-features">Dyno&rsquo;s ability to resolve Chapel
features</a></p>
</li>
</ul>
<p>Other highlights of Chapel 2.4 that are not covered in this article
include:</p>
<ul>
<li>
<p>Parallel iterator and zippering support over the
<a href="https://chapel-lang.org/docs/2.4/modules/standard/Set.html"target="_blank" rel="noopener"><code>set</code></a>
and
<a href="https://chapel-lang.org/docs/2.4/modules/standard/Map.html"target="_blank" rel="noopener"><code>map</code></a>
types</p>
</li>
<li>
<p>The ability to query the <a href="https://chapel-lang.org/docs/2.4/language/spec/locales.html#ChapelLocale.locale.numColocales"target="_blank" rel="noopener">number of
co-locales</a>
running on a node</p>
</li>
<li>
<p>New custom settings, location-based rules, and documentation for the
<a href="https://chapel-lang.org/docs/2.4/tools/chplcheck/chplcheck.html"target="_blank" rel="noopener"><code>chplcheck</code></a>
linter</p>
</li>
</ul>
<p>For a much more complete list of changes in Chapel 2.4, see the
<a href="https://github.com/chapel-lang/chapel/blob/release/2.4/CHANGES.md"target="_blank" rel="noopener">CHANGES.md</a>
file.  And huge thanks to <a href="https://github.com/chapel-lang/chapel/blob/release/2.4/CONTRIBUTORS.md"target="_blank" rel="noopener">all the Chapel community
members</a>
who contributed to version 2.4!</p>
<h3 id="multidimensional-array-literals">
  <a href="#multidimensional-array-literals">Multidimensional Array Literals</a>
</h3>
<p>Since Chapel&rsquo;s inception, the language has supported both
multidimensional rectangular arrays and <em>arrays of arrays</em>â€”arrays
whose elements also happen to be arrays.  For example, the following
declarations each create <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">n^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> array elements, where the first is a
2D array of real floating point values (<code>real</code>), while the second is
a 1D array whose elements are each a 1D array of <code>real</code> values:</p>
<div class="highlight" data-code-type="main" data-code-section="middle"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Chapel" data-lang="Chapel"><span class="line"><span class="cl"><span class="w">  </span><span class="kd">config</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">Arr2D</span><span class="p">:</span><span class="w">    </span><span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="nx">n</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">..</span><span class="nx">n</span><span class="p">]</span><span class="w"> </span><span class="kt">real</span><span class="p">,</span><span class="w">   </span><span class="c1">// a 2D array of reals
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">      </span><span class="nx">ArrOfArr</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="nx">n</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="nx">n</span><span class="p">]</span><span class="w"> </span><span class="kt">real</span><span class="p">;</span><span class="w">  </span><span class="c1">// a 1D array of 1D arrays of reals
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>There are a few differences between these two types in Chapel, as
well as potential motivations for using either over the other.</p>
<details>
    <summary><strong>(Expand this section for background on some of the key differences&hellip;)</strong></summary>

    <div style="padding-left: 2vw; padding-right: 2vw; padding-bottom: 2ch;">
        <p>Focusing on the simple declarations above, some important
distinctions between the two array types are:</p>
<ul>
<li>
<p><code>Arr2D</code> will allocate all of its elements using a single block of
consecutive memory.  In contrast, <code>ArrOfArr</code> allocates each of its
inner array&rsquo;s <code>n</code> elements in a block of consecutive memory, but
with no guarantee as to where each inner array will be placed in
memory relative to the others.</p>
</li>
<li>
<p>The elements of <code>Arr2D</code> can be accessed using either a pair of
integer indices or a 2-tuple of integers. However, <code>ArrOfArr</code> must
be indexed using an integer index to select one of its inner
arrays, after which a second integer index can be used to access
one of its <code>real</code> values.  This can be seen in the following
lines, which write and read elements of each array:</p>
</li>
</ul>
<div class="highlight" data-code-type="main" data-code-section="middle"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Chapel" data-lang="Chapel"><span class="line"><span class="cl"><span class="w"> </span><span class="c1">// Initialize the arrays using element-wise assignments
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w"> </span><span class="k">forall</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="kd">in</span><span class="w"> </span><span class="mi">1</span><span class="o">..</span><span class="nx">n</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="k">forall</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="kd">in</span><span class="w"> </span><span class="mi">1</span><span class="o">..</span><span class="nx">n</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="kd">const</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">10.0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nx">Arr2D</span><span class="p">[</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">val</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nx">ArrOfArr</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">val</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="c1">// read a 2-tuple index from the console
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="nx">IO</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">read</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="kt">int</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="c1">// use it to index the 2D array directly
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w"> </span><span class="nx">writeln</span><span class="p">(</span><span class="nx">Arr2D</span><span class="p">[</span><span class="nx">idx</span><span class="p">]);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="c1">// index the array-of-arrays by indexing into the tuple...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w"> </span><span class="nx">writeln</span><span class="p">(</span><span class="nx">ArrOfArr</span><span class="p">[</span><span class="nx">idx</span><span class="p">(</span><span class="mi">0</span><span class="p">)][</span><span class="nx">idx</span><span class="p">(</span><span class="mi">1</span><span class="p">)]);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="c1">// ...or by de-tupling it into distinct integers:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">idx</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nx">writeln</span><span class="p">(</span><span class="nx">ArrOfArr</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Note that multidimensional arrays and tuple-based indexing can be
particularly valuable when writing rank-independent code, since
they don&rsquo;t require a number of commas or brackets proportional to
the array&rsquo;s rank.</p>
<ul>
<li><code>Arr2D</code> can also be <em>sliced</em> across both of its dimensions to
create a pseudo-array that refers to the elements in question.  In
contrast, <code>ArrOfArr</code> doesn&rsquo;t support directly referring to an
arbitrary subset of its elementsâ€”just to some or all of the
elements in one of its inner arrays:</li>
</ul>
<div class="highlight" data-code-type="main" data-code-section="middle"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Chapel" data-lang="Chapel"><span class="line"><span class="cl"><span class="w"> </span><span class="nx">inspectArr</span><span class="p">(</span><span class="nx">Arr2D</span><span class="p">[</span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="o">..</span><span class="p">]);</span><span class="w">             </span><span class="c1">// pass the i-th row
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w"> </span><span class="nx">inspectArr</span><span class="p">(</span><span class="nx">Arr2D</span><span class="p">[</span><span class="o">..</span><span class="p">,</span><span class="w"> </span><span class="nx">j</span><span class="p">]);</span><span class="w">             </span><span class="c1">// pass the j-th column
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w"> </span><span class="nx">inspectArr</span><span class="p">(</span><span class="nx">Arr2D</span><span class="p">[</span><span class="nx">n</span><span class="o">/</span><span class="mi">2</span><span class="o">..#</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nx">n</span><span class="o">/</span><span class="mi">2</span><span class="o">..#</span><span class="mi">2</span><span class="p">]);</span><span class="w">  </span><span class="c1">// pass the central 2x2 sub-array
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nx">inspectArr</span><span class="p">(</span><span class="nx">ArrOfArr</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span><span class="w">              </span><span class="c1">// pass the i-th inner array
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w"> </span><span class="nx">inspectArr</span><span class="p">(</span><span class="nx">ArrOfArr</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">n</span><span class="o">/</span><span class="mi">2</span><span class="o">..#</span><span class="mi">2</span><span class="p">]);</span><span class="w">     </span><span class="c1">// pass the i-th array&#39;s center
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="c1">// print an array&#39;s values and indices
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w"> </span><span class="k">proc</span><span class="w"> </span><span class="nf">inspectArr</span><span class="p">(</span><span class="nx">X</span><span class="p">:</span><span class="w"> </span><span class="p">[?</span><span class="nx">I</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nx">writeln</span><span class="p">(</span><span class="s">&#34;Got array:&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nx">writeln</span><span class="p">(</span><span class="nx">X</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nx">writeln</span><span class="p">(</span><span class="s">&#34;Declared over indices &#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">I</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;\n&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div>
    </div>
</details>

<p>Despite Chapel&rsquo;s longstanding support for multidimensional array
types and computations, up until this week&rsquo;s release, the language
has only supported a syntax for specifying 1D array values, or
<em>literals</em>.  Thus, a user could write:</p>
<div class="highlight" data-code-type="main" data-code-section="middle"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Chapel" data-lang="Chapel"><span class="line"><span class="cl"><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nx">Arr1D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">];</span><span class="w">  </span><span class="c1">// declare a 1D, type-inferred array
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>or:</p>
<div class="highlight" data-code-type="main" data-code-section="middle"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Chapel" data-lang="Chapel"><span class="line"><span class="cl"><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nx">ArrOfArrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">]];</span><span class="w">  </span><span class="c1">// declare an array of arrays
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>where these two declarations rely on Chapel&rsquo;s type inference to
infer that the variables are arrays, based on the initializing array
literal.</p>
<p>However, there has not been an equivalent way to declare a
type-inferred multidimensional array, nor to create such a value to
pass as an argument or compute with directly.  This deficiency in
the language has long been noted by users, who have requested a
solution.</p>
<p>Happily, Chapel 2.4 adds this requested feature.  Even better, the
approach taken reflects the result of intensive user discussions,
including live community feedback sessions to reach consensus.  The
resulting approach is to use semicolons as a kind of &ldquo;heavyweight
comma&rdquo; to indicate the end of a dimension.  Thus, a 2D 3<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Ã—</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">Ã—</span></span></span></span>3
array can be written:</p>
<div class="highlight" data-code-type="main" data-code-section="middle"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Chapel" data-lang="Chapel"><span class="line"><span class="cl"><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nx">Arr3by3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="mi">21</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="mi">31</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="p">];</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Similarly, a 3D, 2<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Ã—</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">Ã—</span></span></span></span>2<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Ã—</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">Ã—</span></span></span></span>2
array can be written:</p>
<div class="highlight" data-code-type="main" data-code-section="middle"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Chapel" data-lang="Chapel"><span class="line"><span class="cl"><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nx">Arr3D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">11.1</span><span class="p">,</span><span class="w"> </span><span class="mf">12.1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="mf">21.1</span><span class="p">,</span><span class="w"> </span><span class="mf">22.1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="mf">11.2</span><span class="p">,</span><span class="w"> </span><span class="mf">12.2</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="mf">21.2</span><span class="p">,</span><span class="w"> </span><span class="mf">22.2</span><span class="p">];</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Note that the whitespace and linefeeds used in these examples are
optional, but used here to improve readability.</p>
<p>We&rsquo;re very pleased by the addition of this feature, and thoroughly
appreciate all the input we&rsquo;ve received from the Chapel community on
this topic over the years, and particularly as we completed the
feature over the past few months.</p>
<h3 id="python-interoperability">
  <a href="#python-interoperability">Python Interoperability</a>
</h3>
<p>Chapel 2.4 contains significant improvements to the Python
interoperability support that we introduced in version 2.3.  Let&rsquo;s
look at some of the improvements in terms of ergonomics and data
types:</p>
<h4 id="ergonomic-improvements">
  <a href="#ergonomic-improvements">Ergonomic Improvements</a>
</h4>
<p>As a motivating example, consider the following snippet of Python
code:</p>





<div class="file" data-code-type="main">
    <div class="file-header">
        <a href=code/compute_sum_lib.py download="compute_sum_lib.py">compute_sum_lib.py</a>
        
    </div>

    
    <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">compute_sum</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div>

</div>

<p>Previously, calling <code>compute_sum()</code> on a Chapel array required a lot
of explicit handling of types; it also resulted in <code>lst</code> being
copied twice, unnecessarily.  Calling such a function also required
using multiple files, as the Python code needed to be in its own
module for Chapel to import.  Here&rsquo;s an example of how this looked
in Chapel 2.3:</p>
<div class="highlight" data-code-type="main" data-code-section="middle"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Chapel" data-lang="Chapel"><span class="line"><span class="cl"><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="nx">Python</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">interp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nx">Interpreter</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="c1">// the old way of invoking &#39;compute_sum()&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">lib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nx">Module</span><span class="p">(</span><span class="nx">interp</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;compute_sum_lib&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="nx">compute_sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nx">Function</span><span class="p">(</span><span class="nx">lib</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;compute_sum&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="kd">var</span><span class="w"> </span><span class="nx">myArr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nx">i</span><span class="w"> </span><span class="kd">in</span><span class="w"> </span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">]</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">compute_sum</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">myArr</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nx">writeln</span><span class="p">(</span><span class="s">&#34;The sum of the numbers from 1 to 10 is &#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>In this week&rsquo;s release, this computation can now be expressed much
more succinctly and with less overhead.  Rather than importing a
piece of Python code from a standalone module, we can now
<span class="sidenote"><label class="sidenote-label" for="sidenote-0">directly load a string to create a new Python module:</label><input class="sidenote-checkbox" type="checkbox" id="sidenote-0"></input><span class="sidenote-content sidenote-right"><span class="sidenote-delimiter">[note:</span>
Chapel 2.4 can also directly pull in Python bytecode as
a module or a <a href =
"https://docs.python.org/3/library/pickle.html">pickle object</a> as
a value. <span class="sidenote-delimiter">]</span></span></span></p>
<div class="highlight" data-code-type="main" data-code-section="middle"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Chapel" data-lang="Chapel"><span class="line"><span class="cl"><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">lib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">interp</span><span class="p">.</span><span class="nx">importModule</span><span class="p">(</span><span class="s">&#34;compute_sum_lib&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="s">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">   import numpy as np
</span></span></span><span class="line"><span class="cl"><span class="s">   def compute_sum(lst):
</span></span></span><span class="line"><span class="cl"><span class="s">       arr = np.asarray(lst)
</span></span></span><span class="line"><span class="cl"><span class="s">       return np.sum(arr)
</span></span></span><span class="line"><span class="cl"><span class="s">   &#34;&#34;&#34;</span><span class="p">.</span><span class="nx">dedent</span><span class="p">());</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>This gives us a <code>lib</code> object like before, but without the need for a
separate file.  And now, when we acquire a handle to <code>compute_sum()</code>,
it reads better:</p>
<div class="highlight" data-code-type="main" data-code-section="middle"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">80
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Chapel" data-lang="Chapel"><span class="line"><span class="cl"><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">compute_sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lib</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;compute_sum&#39;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>The next lines are the most important part, as we can now call
<code>compute_sum()</code> using a direct reference to the Chapel array (rather
than the default copying behavior) and get the result back:</p>
<div class="highlight" data-code-type="main" data-code-section="middle"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Chapel" data-lang="Chapel"><span class="line"><span class="cl"><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nx">myArr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nx">i</span><span class="w"> </span><span class="kd">in</span><span class="w"> </span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">]</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">compute_sum</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nx">Array</span><span class="p">(</span><span class="nx">interp</span><span class="p">,</span><span class="w"> </span><span class="nx">myArr</span><span class="p">));</span><span class="w">  </span><span class="c1">// no copies are done!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nx">writeln</span><span class="p">(</span><span class="s">&#34;The sum of the numbers from 1 to 10 is &#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>We can actually make one more productivity improvement here. Since all
we do with <code>res</code> is print it out, we don&rsquo;t really need to specify
the return type of <code>compute_sum()</code> at all:</p>
<div class="highlight" data-code-type="main" data-code-section="middle"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Chapel" data-lang="Chapel"><span class="line"><span class="cl"><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nx">res2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">compute_sum</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nx">Array</span><span class="p">(</span><span class="nx">interp</span><span class="p">,</span><span class="w"> </span><span class="nx">myArr</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nx">writeln</span><span class="p">(</span><span class="s">&#34;The sum of the numbers from 1 to 10 is &#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">res2</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>In this version, <code>res2</code> is a generic Python value that Chapel&rsquo;s
<code>Python</code> module knows how to print, so we can just pass it to
<code>writeln()</code> directly. While this is a small change, across larger
programs such brevity can add up.</p>
<p>All of the improvements above come together to form a much more
ergonomic and powerful interface to the Python ecosystem.</p>
<h4 id="data-type-improvements">
  <a href="#data-type-improvements">Data Type Improvements</a>
</h4>
<p>Chapel 2.4 also expands the Chapel types that the <code>Python</code> module
understands, specifically adding the new Chapel types <code>PyList</code>,
<code>PySet</code>, <code>PyDict</code>, and <span class="sidenote"><label class="sidenote-label" for="sidenote-1"><code>PyArray</code></label><input class="sidenote-checkbox" type="checkbox" id="sidenote-1"></input><span class="sidenote-content sidenote-right"><span class="sidenote-delimiter">[note:</span> Python
provides a low-level <code>array</code> type that the Chapel
<code>PyArray</code> type represents. This type can also refer to other
array-like things in Python, such as NumPy arrays. <span class="sidenote-delimiter">]</span></span></span>.
Values of these types are handles to Python objects that provide
specialization over an abstract <code>Value</code> type.</p>
<p>For example, the following code creates a Python set, and then adds
new elements to it.  The <code>make_set()</code> function it uses is a simple
Python function that takes an arbitrary number of arguments,
returning a set containing those arguments.</p>
<div class="highlight" data-code-type="main" data-code-section="middle"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Chapel" data-lang="Chapel"><span class="line"><span class="cl"><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nx">make_set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">interp</span><span class="p">.</span><span class="nx">importModule</span><span class="p">(</span><span class="s">&#34;make_set&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="s">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">   def make_set(*args):
</span></span></span><span class="line"><span class="cl"><span class="s">       return set(args)
</span></span></span><span class="line"><span class="cl"><span class="s">   &#34;&#34;&#34;</span><span class="p">.</span><span class="nx">dedent</span><span class="p">()).</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;make_set&#39;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Using <code>make_set()</code>, we can create a set containing arbitrary elements:</p>
<div class="highlight" data-code-type="main" data-code-section="middle"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">97
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Chapel" data-lang="Chapel"><span class="line"><span class="cl"><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">make_set</span><span class="p">(</span><span class="k">owned</span><span class="w"> </span><span class="nx">PySet</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>We <em>could</em> use a generic return type and have an opaque handle to the
set, but since we know it&rsquo;s a set, we use the <code>PySet</code> type to
get a more specialized handle. This lets us invoke set-specific
operations using normal Chapel method calls:</p>
<div class="highlight" data-code-type="main" data-code-section="middle"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Chapel" data-lang="Chapel"><span class="line"><span class="cl"><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s">&#34;hello&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s">&#34;world&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nx">writeln</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>For those familiar with Chapel&rsquo;s sets, the above may look a little
suspect.  A Chapel <code>set</code> can only store a single element type, but
here, we are adding strings to a set that was originally created to
store integers. By using the Python set, we are taking advantage of
Python&rsquo;s loose typing and can store any type we&rsquo;d like (provided the
<code>Python</code> module knows how to convert the data to Python). This
doesn&rsquo;t result in the same performance and parallelism as native Chapel
sets support, but it provides a new level of flexibility to Chapel
programmers using Python code.</p>
<p>The combination of exposing these new Python types and the
aforementioned ergonomic improvements make the <code>Python</code> module far
more powerful and easy to use than it was in the previous Chapel 2.3
release.  We&rsquo;re very interested in hearing feedback from users on
their experiences with the module.</p>
<h3 id="chapel-support-for-cmake">
  <a href="#chapel-support-for-cmake">Chapel Support for CMake</a>
</h3>
<p>Chapel 2.4 also contains new support for building Chapel
applications with CMake. Previously, users could only use CMake to
build Chapel by defining custom commands. We now provide CMake
module files to build applications in a more idiomatic
way.</p>
<p>Currently, this is enabled by adding the necessary files to your
project.  As an example, the following <code>CMakeLists.txt</code> file builds
a simple Chapel application from two module files, <code>A.chpl</code> and
<code>B.chpl</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmake" data-lang="cmake"><span class="line"><span class="cl"><span class="nb">find_package</span><span class="p">(</span><span class="s">chpl</span> <span class="s">REQUIRED</span> <span class="s">HINTS</span> <span class="s">.</span><span class="p">)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="nb">project</span><span class="p">(</span><span class="s">myProgram</span> <span class="s">LANGUAGES</span> <span class="s">CHPL</span><span class="p">)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="nb">add_executable</span><span class="p">(</span><span class="s">myProgram</span> <span class="s">A.chpl</span> <span class="s">B.chpl</span><span class="p">)</span><span class="err">
</span></span></span></code></pre></div><p>This results in a project that can be built and executed using the
normal CMake workflow:</p>
<pre tabindex="0"><code class="language-terminal" data-lang="terminal">$ mkdir build &amp;&amp; cd build
$ cmake ..
$ make
$ ./myProgram
</code></pre><p>See <a href="https://chapel-lang.org/docs/2.4/usingchapel/compiling.html#cmake"target="_blank" rel="noopener">the documentation for this new
support</a>
for more information.</p>
<h3 id="dyno-support-for-chapel-features">
  <a href="#dyno-support-for-chapel-features">Dyno Support for Chapel Features</a>
</h3>
<p>As you may have seen in <a href="../../posts/announcing-chapel-2.3/#dyno-compiler-improvements">previous</a>
<a href="../../posts/announcing-chapel-1.31/#scope-resolution-and-errors-by-dyno">release</a>
<a href="../../posts/announcing-chapel-1.29/#better-error-messages-via-dyno">announcements</a>, <em>Dyno</em>
is the name of a project whose aim is to modernize and improve the
Chapel compiler. Dyno improves error messages, allows incremental
type resolution, and enables the <a href="../../posts/chapel-py/">development of language
tooling</a>.  Among the major wins for this
ongoing effort is the <a href="https://chapel-lang.org/docs/2.4/tools/chpl-language-server/chpl-language-server.html"target="_blank" rel="noopener">Chapel Language Server
(CLS)</a>,
which was previously featured on this blog in <a href="../../posts/chapel-lsp/">the post about editor
integration</a>.  The team has been hard
at work implementing many features of Chapel&rsquo;s type system in Dyno,
which&mdash;among other things&mdash;will enable tools like CLS to
provide more accurate and helpful information to users.</p>
<p>This release has seen a significant number of language features come
online within Dyno. One major area of focus has been Dyno&rsquo;s support
for arrays and domains.  These types are incredibly powerful and
implemented using Chapel.  As a result, they draw on a lot of the
language&rsquo;s features. The following picture shows an editor in which
CLS is displaying the type information computed by Dyno (in grey)
for the Chapel program that follows, which relies heavily on
inferred types.</p>
<p><figure class="fullwide"><img src="../../posts/announcing-chapel-2.4/release-2.4-arrays.png">
</figure>





<div class="file" data-code-type="main">
    <details open >
        <summary class="file-header">
            <a href=code/release-2.4-arrays.chpl download="release-2.4-arrays.chpl">release-2.4-arrays.chpl</a>
            
        </summary>
        
        <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-chapel" data-lang="chapel"><span class="line"><span class="cl"><span class="kd">var</span><span class="w"> </span><span class="nx">A</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">]</span><span class="w"> </span><span class="kt">int</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">var</span><span class="w"> </span><span class="nx">B</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">A</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Convert &#39;foreach&#39; loop expression into array by assigning it to a variable.
</span></span></span><span class="line"><span class="cl"><span class="c1">// The type annotation explicitly shows where the array is created. 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span><span class="w"> </span><span class="nx">FromIter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">foreach</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="kd">in</span><span class="w"> </span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kt">real</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="p">)</span><span class="w"> </span><span class="kd">in</span><span class="w"> </span><span class="k">zip</span><span class="p">(</span><span class="nx">A</span><span class="p">,</span><span class="w"> </span><span class="nx">B</span><span class="p">,</span><span class="w"> </span><span class="nx">FromIter</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">var</span><span class="w"> </span><span class="nx">AD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">A</span><span class="p">.</span><span class="k">domain</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">var</span><span class="w"> </span><span class="nx">AssocD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&#34;key&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;another key&#34;</span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">type</span><span class="w"> </span><span class="nx">SubAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sparse</span><span class="w"> </span><span class="k">subdomain</span><span class="p">(</span><span class="nx">A</span><span class="p">.</span><span class="k">domain</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">var</span><span class="w"> </span><span class="nx">mySD</span><span class="p">:</span><span class="w"> </span><span class="nx">SubAD</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div>
    </details>
</div>
</p>
<p>In addition to arrays and domains, Dyno is now capable of verifying
<a href="https://chapel-lang.org/docs/2.4/technotes/interfaces.html"target="_blank" rel="noopener">interface
constraints</a>.
The <a href="https://chapel-lang.org/docs/2.4/technotes/manage.html"target="_blank" rel="noopener"><code>manage</code>
statement</a>,
similar to Python&rsquo;s <code>with</code>, and built on top of interfaces, is also
now supported.  The following program demonstrates resolving a
<code>manage</code> statement, as well as the error issued when the
<code>contextManager</code> interface constraint is not met.</p>
<p><figure class="fullwide"><img src="../../posts/announcing-chapel-2.4/release-2.4-interfaces.png">
</figure>





<div class="file" data-code-type="main">
    <details>
        <summary class="file-header">
            <a href=code/release-2.4-interfaces.chpl download="release-2.4-interfaces.chpl">release-2.4-interfaces.chpl</a>
            
        </summary>
        
        <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-chapel" data-lang="chapel"><span class="line"><span class="cl"><span class="k">record</span><span class="w"> </span><span class="nc">myType</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">contextManager</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">proc</span><span class="w"> </span><span class="nf">enterContext</span><span class="p">():</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">proc</span><span class="w"> </span><span class="nf">exitContext</span><span class="p">(</span><span class="kd">in</span><span class="w"> </span><span class="nx">error</span><span class="p">:</span><span class="w"> </span><span class="k">owned</span><span class="w"> </span><span class="nx">Error</span><span class="p">?)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nx">manage</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nx">myType</span><span class="p">())</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nx">managedValue</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">record</span><span class="w"> </span><span class="nc">myTypeNoContext</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">contextManager</span><span class="w"> </span><span class="p">{}</span></span></span></code></pre></td></tr></table>
</div>
</div>
    </details>
</div>
</p>
<p>Another group of features that is fun to demonstrate are those that
have to do with the compiler itself. In 2.4, Dyno is able to handle
<a href="https://chapel-lang.org/docs/2.4/modules/standard/Errors.html#Errors.compilerError"target="_blank" rel="noopener"><code>compilerError()</code></a>
and
<a href="https://chapel-lang.org/docs/2.4/modules/standard/Errors.html#Errors.compilerWarning"target="_blank" rel="noopener"><code>compilerWarning()</code></a>,
as well as routines for retrieving the current line number and
filename. The following program demonstrates the use of these:</p>
<p><figure class="fullwide"><img src="../../posts/announcing-chapel-2.4/release-2.4-compiler.png">
</figure>





<div class="file" data-code-type="main">
    <details>
        <summary class="file-header">
            <a href=code/release-2.4-compiler.chpl download="release-2.4-compiler.chpl">release-2.4-compiler.chpl</a>
            
        </summary>
        
        <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-chapel" data-lang="chapel"><span class="line"><span class="cl"><span class="k">use</span><span class="w"> </span><span class="nx">Reflection</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">param</span><span class="w"> </span><span class="nx">lineNo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getLineNumber</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nx">compilerWarning</span><span class="p">(</span><span class="s">&#34;This is bad, chief!&#34;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nx">compilerError</span><span class="p">(</span><span class="s">&#34;It&#39;s so over. Error in file &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">getFileName</span><span class="p">(),</span><span class="w"> </span><span class="nx">errorDepth</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div>
    </details>
</div>
</p>
<p>All of the code presented in this section began resolving in Dyno
for the first time in Chapel 2.4, and this doesn&rsquo;t even remotely
cover <span class="sidenote"><label class="sidenote-label" for="sidenote-2">all the improvements that have been made</label><input class="sidenote-checkbox" type="checkbox" id="sidenote-2"></input><span class="sidenote-content sidenote-right"><span class="sidenote-delimiter">[note:</span>
Over 27 PRs have been merged into the Dyno library since
the December release.  <span class="sidenote-delimiter">]</span></span></span> since version 2.3. With
each release, Dyno draws nearer to feature parity with the
production compiler.</p>
<p>Since Dyno is still a work-in-progress, the editor features showcased
above are turned off by default in CLS. You can try them by
<a href="https://chapel-lang.org/docs/2.4/tools/chpl-language-server/chpl-language-server.html#experimental-resolver-features"target="_blank" rel="noopener">enabling experimental features</a>.</p>
<h3 id="for-more-information">
  <a href="#for-more-information">For More Information</a>
</h3>
<p>If you have questions about Chapel 2.4 or its new features, please
reach out on Chapel&rsquo;s <a href="https://discord.gg/xu2xg45yqH"target="_blank" rel="noopener">Discord
channel</a>, <a href="https://chapel.discourse.group/"target="_blank" rel="noopener">Discourse
group</a>, or one of our other
<a href="https://chapel-lang.org/community/"target="_blank" rel="noopener">community forums</a>.  As always,
we&rsquo;re interested in feedback on how we can make the Chapel language,
libraries, implementation, and tools more useful to you.</p>

</div>

        </main>
<div class="container">
    <div class="share-view">
        <h3>Share this article:</h3>
        <div class="share-buttons">
        
        
        <a style="--button-color: #3a559f; --button-color-light: white;" class="button share-button" href="https://www.facebook.com/sharer/sharer.php?description=Check&#43;out&#43;this&#43;post&#43;on&#43;the&#43;Chapel&#43;Programming&#43;Language&#43;blog%3A&#43;Announcing&#43;Chapel&#43;2.4%21&amp;u=https%3A%2F%2Fchapel-lang.org%2Fblog%2Fposts%2Fannouncing-chapel-2.4%2F" target="_blank" rel="noopener noreferrer">
    <img width="30" height="30" src="../../img/facebook-logo.png" alt="Share on Facebook">
</a>

        <a style="--button-color: #2867b2; --button-color-light: white;" class="button share-button" href="https://linkedin.com/share?text=Check&#43;out&#43;this&#43;post&#43;on&#43;the&#43;Chapel&#43;Programming&#43;Language&#43;blog%3A&#43;Announcing&#43;Chapel&#43;2.4%21&amp;url=https%3A%2F%2Fchapel-lang.org%2Fblog%2Fposts%2Fannouncing-chapel-2.4%2F" target="_blank" rel="noopener noreferrer">
    <img width="30" height="30" src="../../img/linkedin-logo.png" alt="Share on LinkedIn">
</a>

        <a style="--button-color: #ff4500; --button-color-light: white;" class="button share-button" href="https://new.reddit.com/submit?title=Announcing&#43;Chapel&#43;2.4%21&amp;url=https%3A%2F%2Fchapel-lang.org%2Fblog%2Fposts%2Fannouncing-chapel-2.4%2F" target="_blank" rel="noopener noreferrer">
    <img width="30" height="30" src="../../img/reddit-logo.svg" alt="Share on Reddit">
</a>

        <a style="--button-color: #000000; --button-color-light: #7a7a7a;" class="button share-button" href="http://x.com/share?text=Check&#43;out&#43;this&#43;post&#43;on&#43;the&#43;Chapel&#43;Programming&#43;Language&#43;blog%3A&#43;Announcing&#43;Chapel&#43;2.4%21&amp;url=https%3A%2F%2Fchapel-lang.org%2Fblog%2Fposts%2Fannouncing-chapel-2.4%2F" target="_blank" rel="noopener noreferrer">
    <img width="30" height="30" src="../../img/x-logo.svg" alt="Share on X">
</a>

        </div>
    </div>
</div>


    </body>
</html>
