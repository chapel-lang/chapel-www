<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UnorderedAtomics &mdash; Chapel Documentation 1.29</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/style.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="UnorderedCopy" href="UnorderedCopy.html" />
    <link rel="prev" title="C_MPI" href="MPI/C_MPI.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

<a href="../../index.html" class="icon icon-home"> Chapel Documentation

<!-- display version if button won't be rendered -->
<?php if (false) { ?>
<br>1.29
<?php } ?>

</a>

<?php
// Variables given by sphinx
$chplTitle = "1.29";
$pagename = "modules/packages/UnorderedAtomics";
include "../..//versionButton.php";
?>


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
              <p class="caption" role="heading"><span class="caption-text">Compiling and Running Chapel</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usingchapel/QUICKSTART.html">Quickstart Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usingchapel/index.html">Using Chapel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../platforms/index.html">Platform-Specific Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../technotes/index.html">Technical Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">Docs for Contributors</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Writing Chapel Programs</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../language/reference.html">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Hello World Variants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../primers/index.html">Primers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../language/spec/index.html">Language Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../builtins/index.html">Built-in Types and Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../standard.html">Standard Modules</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../packages.html">Package Modules</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../packages.html#algorithms">Algorithms</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../packages.html#communication-inter-locale">Communication (Inter-Locale)</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="AllLocalesBarriers.html">AllLocalesBarriers</a></li>
<li class="toctree-l3"><a class="reference internal" href="CopyAggregation.html">CopyAggregation</a></li>
<li class="toctree-l3"><a class="reference internal" href="MPI.html">MPI</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">UnorderedAtomics</a></li>
<li class="toctree-l3"><a class="reference internal" href="UnorderedCopy.html">UnorderedCopy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../packages.html#data-structures">Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packages.html#file-formats-and-i-o">File Formats and I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packages.html#math-numerical-computing">Math / Numerical Computing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packages.html#memory-management">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packages.html#networking-inter-process-communication">Networking / Inter-Process Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packages.html#parallel-computing">Parallel Computing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packages.html#tool-support">Tool Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packages.html#utilities">Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packages.html#miscellaneous">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../layoutdist.html">Standard Layouts and Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mason-packages/index.html">Mason Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../users-guide/index.html">Chapel Users Guide (WIP)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Language History</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../language/evolution.html">Chapel Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../language/archivedSpecs.html">Documentation Archives</a></li>
</ul>

  <p class="caption" role="heading"><span class="caption-text">Indexes</span></p>
  <ul>
    <li class="toctree-11"><a class="reference internal" href="../../chpl-modindex.html">Chapel Module Index</a></li>
    <li class="toctree-11"><a class="reference internal" href="../../genindex.html">Complete Docs Index</a></li>
  </ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Chapel Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../packages.html">Package Modules</a> &raquo;</li>
      <li>UnorderedAtomics</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/modules/packages/UnorderedAtomics.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <span class="target" id="module-UnorderedAtomics"></span><div class="section" id="unorderedatomics">
<h1>UnorderedAtomics<a class="headerlink" href="#unorderedatomics" title="Permalink to this headline">¶</a></h1>
<p><strong>Usage</strong></p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">UnorderedAtomics</span><span class="p">;</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nx">UnorderedAtomics</span><span class="p">;</span>
</pre></div>
</div>
<p>Support for unordered non-fetching atomic operations.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This module represents work in progress. The API is unstable and likely to
change over time.</p>
</div>
<p>This module provides unordered versions of non-fetching atomic operations for
all <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">uint</span></code>, and <code class="docutils literal notranslate"><span class="pre">real</span></code> types.  Unordered versions of
<a class="reference internal" href="../../language/spec/task-parallelism-and-synchronization.html#Atomics.add" title="Atomics.add"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">add()</span></code></a>, <a class="reference internal" href="../../language/spec/task-parallelism-and-synchronization.html#Atomics.sub" title="Atomics.sub"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">sub()</span></code></a>, <a class="reference internal" href="../../language/spec/task-parallelism-and-synchronization.html#Atomics.or" title="Atomics.or"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">or()</span></code></a>,
<a class="reference internal" href="../../language/spec/task-parallelism-and-synchronization.html#Atomics.and" title="Atomics.and"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">and()</span></code></a>, and <a class="reference internal" href="../../language/spec/task-parallelism-and-synchronization.html#Atomics.xor" title="Atomics.xor"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">xor()</span></code></a> are provided. The results
of these functions are not visible until task or forall termination or an
explicit <a class="reference internal" href="#UnorderedAtomics.unorderedAtomicTaskFence" title="UnorderedAtomics.unorderedAtomicTaskFence"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">unorderedAtomicTaskFence()</span></code></a>, but they can provide a
significant speedup for bulk atomic operations that do not require ordering:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">UnorderedAtomics</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">numTasksPerLocale</span> <span class="o">=</span> <span class="nx">here</span><span class="p">.</span><span class="nx">maxTaskPar</span><span class="p">,</span>
      <span class="nx">iters</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">a</span><span class="p">:</span> <span class="k">atomic</span> <span class="kt">int</span><span class="p">;</span>

<span class="k">coforall</span> <span class="nx">loc</span> <span class="kd">in</span> <span class="nx">Locales</span> <span class="k">do</span> <span class="k">on</span> <span class="nx">loc</span> <span class="k">do</span>
  <span class="k">coforall</span> <span class="mi">1</span><span class="o">..</span><span class="nx">numTasksPerLocale</span> <span class="k">do</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="nx">iters</span> <span class="k">do</span>
      <span class="nx">a</span><span class="p">.</span><span class="nx">unorderedAdd</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span> <span class="c1">// unordered atomic add</span>

<span class="c1">// no fence required, fenced at task termination</span>

<span class="kd">const</span> <span class="nx">itersSum</span> <span class="o">=</span> <span class="nx">iters</span><span class="o">*</span><span class="p">(</span><span class="nx">iters</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="c1">// sum from 1..iters</span>
      <span class="nx">numTasks</span> <span class="o">=</span> <span class="nx">numLocales</span> <span class="o">*</span> <span class="nx">numTasksPerLocale</span><span class="p">;</span>
<span class="nx">assert</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">read</span><span class="p">()</span> <span class="o">==</span> <span class="nx">numTasks</span> <span class="o">*</span> <span class="nx">itersSum</span><span class="p">);</span>
</pre></div>
</div>
<p>It’s important to be aware that unordered atomic operations are not
consistent with regular atomic operations and updates may not be visible
until the task or forall that issued them terminates or they are explicitly
fenced with <a class="reference internal" href="#UnorderedAtomics.unorderedAtomicTaskFence" title="UnorderedAtomics.unorderedAtomicTaskFence"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">unorderedAtomicTaskFence()</span></code></a>.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">a</span><span class="p">:</span> <span class="k">atomic</span> <span class="kt">int</span><span class="p">;</span>
<span class="nx">a</span><span class="p">.</span><span class="nx">unorderedAdd</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>        <span class="c1">// can print 0 or 1</span>
<span class="nx">unorderedAtomicTaskFence</span><span class="p">();</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>        <span class="c1">// prints 1</span>
</pre></div>
</div>
<p>Generally speaking they are useful for when you have a large batch of atomic
updates to perform and the order of those operations doesn’t matter.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Currently, these are only optimized for <code class="docutils literal notranslate"><span class="pre">CHPL_NETWORK_ATOMICS=ugni</span></code>.
Processor atomics or any other implementation falls back to ordered
operations. Under ugni these operations are internally buffered. When the
buffers are flushed, the operations are performed all at once. Cray Linux
Environment (CLE) 5.2.UP04 or newer is required for best performance. In
our experience, unordered atomics can achieve up to a 5X performance
improvement over ordered atomics for CLE 5.2UP04 or newer.</p>
</div>
<dl class="chpl method">
<dt class="sig sig-object chpl" id="UnorderedAtomics.AtomicT.unorderedAdd">
<em class="property"><span class="pre">proc</span> </em><span class="sig-prename descclassname"><span class="pre">AtomicT.</span></span><span class="sig-name descname"><span class="pre">unorderedAdd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">value:</span> <span class="pre">T</span></em><span class="sig-paren">)</span><span class="pre">:</span> <span class="pre">void</span><a class="headerlink" href="#UnorderedAtomics.AtomicT.unorderedAdd" title="Permalink to this definition">¶</a></dt>
<dd><p>Unordered atomic add.</p>
</dd></dl>

<dl class="chpl method">
<dt class="sig sig-object chpl" id="UnorderedAtomics.AtomicT.unorderedSub">
<em class="property"><span class="pre">proc</span> </em><span class="sig-prename descclassname"><span class="pre">AtomicT.</span></span><span class="sig-name descname"><span class="pre">unorderedSub</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">value:</span> <span class="pre">T</span></em><span class="sig-paren">)</span><span class="pre">:</span> <span class="pre">void</span><a class="headerlink" href="#UnorderedAtomics.AtomicT.unorderedSub" title="Permalink to this definition">¶</a></dt>
<dd><p>Unordered atomic sub.</p>
</dd></dl>

<dl class="chpl method">
<dt class="sig sig-object chpl" id="UnorderedAtomics.AtomicT.unorderedOr">
<em class="property"><span class="pre">proc</span> </em><span class="sig-prename descclassname"><span class="pre">AtomicT.</span></span><span class="sig-name descname"><span class="pre">unorderedOr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">value:</span> <span class="pre">T</span></em><span class="sig-paren">)</span><span class="pre">:</span> <span class="pre">void</span><a class="headerlink" href="#UnorderedAtomics.AtomicT.unorderedOr" title="Permalink to this definition">¶</a></dt>
<dd><p>Unordered atomic or.</p>
</dd></dl>

<dl class="chpl method">
<dt class="sig sig-object chpl" id="UnorderedAtomics.AtomicT.unorderedAnd">
<em class="property"><span class="pre">proc</span> </em><span class="sig-prename descclassname"><span class="pre">AtomicT.</span></span><span class="sig-name descname"><span class="pre">unorderedAnd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">value:</span> <span class="pre">T</span></em><span class="sig-paren">)</span><span class="pre">:</span> <span class="pre">void</span><a class="headerlink" href="#UnorderedAtomics.AtomicT.unorderedAnd" title="Permalink to this definition">¶</a></dt>
<dd><p>Unordered atomic and.</p>
</dd></dl>

<dl class="chpl method">
<dt class="sig sig-object chpl" id="UnorderedAtomics.AtomicT.unorderedXor">
<em class="property"><span class="pre">proc</span> </em><span class="sig-prename descclassname"><span class="pre">AtomicT.</span></span><span class="sig-name descname"><span class="pre">unorderedXor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">value:</span> <span class="pre">T</span></em><span class="sig-paren">)</span><span class="pre">:</span> <span class="pre">void</span><a class="headerlink" href="#UnorderedAtomics.AtomicT.unorderedXor" title="Permalink to this definition">¶</a></dt>
<dd><p>Unordered atomic xor.</p>
</dd></dl>

<dl class="chpl function">
<dt class="sig sig-object chpl" id="UnorderedAtomics.unorderedAtomicTaskFence">
<em class="property"><span class="pre">proc</span> </em><span class="sig-name descname"><span class="pre">unorderedAtomicTaskFence</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><span class="pre">:</span> <span class="pre">void</span><a class="headerlink" href="#UnorderedAtomics.unorderedAtomicTaskFence" title="Permalink to this definition">¶</a></dt>
<dd><p>Fence any pending unordered atomics issued by the current task.</p>
</dd></dl>

</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="MPI/C_MPI.html" class="btn btn-neutral float-left" title="C_MPI" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="UnorderedCopy.html" class="btn btn-neutral float-right" title="UnorderedCopy" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Hewlett Packard Enterprise Development LP.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 



</body>
</html>