<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Distributions &mdash; Chapel Documentation 1.33</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/style.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Memory Consistency Model" href="memory-consistency-model.html" />
    <link rel="prev" title="Locales" href="locales.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

<a href="../../index.html" class="icon icon-home"> Chapel Documentation

<!-- display version if button won't be rendered -->
<?php if (false) { ?>
<br>1.33
<?php } ?>

</a>

<?php
// Variables given by sphinx
$chplTitle = "1.33";
$pagename = "language/spec/domain-maps";
include "../..//versionButton.php";
?>


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
              <p class="caption" role="heading"><span class="caption-text">Compiling and Running Chapel</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usingchapel/QUICKSTART.html">Quickstart Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usingchapel/index.html">Using Chapel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../platforms/index.html">Platform-Specific Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../technotes/index.html">Technical Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">Docs for Contributors</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Writing Chapel Programs</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Hello World Variants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../primers/index.html">Primers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Language Specification</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#introductory-material">Introductory Material</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#language-basics">Language Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#code-structures">Code Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#composite-types">Composite Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#generic-programming">Generic Programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#parallel-programming">Parallel Programming</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#distributed-programming">Distributed Programming</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="locales.html">Locales</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Distributions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#distributions-for-domain-types">Distributions for Domain Types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#distributions-for-domain-values">Distributions for Domain Values</a></li>
<li class="toctree-l4"><a class="reference internal" href="#distributions-for-arrays">Distributions for Arrays</a></li>
<li class="toctree-l4"><a class="reference internal" href="#distributions-are-not-retained-upon-domain-assignment">Distributions Are Not Retained upon Domain Assignment</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#additional-topics">Additional Topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#appendices">Appendices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/standard.html">Standard Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/packages.html">Package Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/layoutdist.html">Standard Layouts and Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mason-packages/index.html">Mason Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../users-guide/index.html">Chapel Users Guide (WIP)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Language History</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../evolution.html">Chapel Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../archivedSpecs.html">Documentation Archives</a></li>
</ul>

  <p class="caption" role="heading"><span class="caption-text">Indexes</span></p>
  <ul>
    <li class="toctree-11"><a class="reference internal" href="../../chpl-modindex.html">Chapel Module Index</a></li>
    <li class="toctree-11"><a class="reference internal" href="../../genindex.html">Complete Docs Index</a></li>
  </ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Chapel Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Chapel Language Specification</a> &raquo;</li>
      <li>Distributions</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/language/spec/domain-maps.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="distributions">
<span id="chapter-domain-maps"></span><h1>Distributions<a class="headerlink" href="#distributions" title="Permalink to this headline">¶</a></h1>
<p>A distribution, also called a <em>domain map</em>,
specifies the implementation of the domains and arrays that
are <em>mapped</em> using it. That is, it defines how domain indices and array
elements are mapped to locales, how they are stored in memory, and how
operations such as accesses, iteration, and slicing are performed. Each
domain and array is mapped using some distribution.</p>
<p>In general, a distribution describes domains and arrays
that are partitioned across multiple locales.
A <em>layout</em> is a distribution that describes domains and arrays
that exist on a single locale.</p>
<p>A distribution is represented in the program with an instance of a
<em>distribution record</em>. Chapel provides a set of standard distributions.
Users can create distributions as well.</p>
<p>Distributions are presented as follows:</p>
<ul class="simple">
<li><p>distributions for
<a class="reference internal" href="#domain-maps-for-types"><span class="std std-ref">domain types</span></a>,
<a class="reference internal" href="#domain-maps-for-values"><span class="std std-ref">domain values</span></a>,
<a class="reference internal" href="#domain-maps-for-arrays"><span class="std std-ref">arrays</span></a></p></li>
<li><p><a class="reference internal" href="#domain-maps-not-assigned"><span class="std std-ref">distributions are not retained upon domain assignment</span></a></p></li>
<li><p><a class="reference internal" href="../../modules/layoutdist.html#layouts-and-distributions"><span class="std std-ref">Standard Layouts and Distributions</span></a>,
such as Block and Cyclic</p></li>
<li><p>specification of user-defined distributions is forthcoming; please
refer to the
<a class="reference internal" href="../../technotes/dsi.html#readme-dsi"><span class="std std-ref">Domain Map Standard Interface technical note</span></a></p></li>
</ul>
<div class="section" id="distributions-for-domain-types">
<span id="domain-maps-for-types"></span><h2>Distributions for Domain Types<a class="headerlink" href="#distributions-for-domain-types" title="Permalink to this headline">¶</a></h2>
<p>Each domain type has a distribution associated with it. This distribution is
used to map all domain values of this type
(see <a class="reference internal" href="#domain-maps-for-values"><span class="std std-ref">Distributions for Domain Values</span></a>).</p>
<p>If a domain type does not have a distribution specified for it explicitly
as described below, a default distribution is provided by the Chapel
implementation. Such a distribution will typically be a layout that maps
the entire domain to the locale on which the current task is executed or
the domain or array variable is declared.</p>
<p>A distribution can be specified explicitly using a <code class="docutils literal notranslate"><span class="pre">dmapped</span></code> clause:</p>
<div class="highlight-syntax notranslate"><div class="highlight"><pre><span></span>mapped-domain-type:
  domain-type &#39;dmapped&#39; distribution-record

distribution-record:
  expression
</pre></div>
</div>
<p>where the <code class="docutils literal notranslate"><span class="pre">distribution-record</span></code> expression produces
an instance of a distribution record.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code class="docutils literal notranslate"><span class="pre">dmapped</span></code> keyword and the <code class="docutils literal notranslate"><span class="pre">dmapped</span></code> clause
are currently unstable and may change in the future.
Factory functions provided by the desired distribution,
when available, should be used instead.</p>
</div>
<blockquote>
<div><p><em>Example</em>.</p>
<p>The code</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">BlockDist</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">MyBlockDist</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">blockDist</span><span class="p">({</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="o">..</span><span class="mi">6</span><span class="p">});</span>
</pre></div>
</div>
<p>creates an instance of the Block distribution record
for two-dimensional domains and arrays
with a bounding box of <code class="docutils literal notranslate"><span class="pre">{1..5,</span> <span class="pre">1..6}</span></code> over all of the locales.</p>
<p><em>Example</em>.</p>
<p>The code</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">BlockDist</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">MyBlockDist</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">blockDist</span><span class="p">({</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="o">..</span><span class="mi">6</span><span class="p">});</span>
<span class="kd">type</span> <span class="nx">MyBlockedDom</span> <span class="o">=</span> <span class="k">domain</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">dmapped</span> <span class="nx">MyBlockDist</span><span class="p">;</span>
</pre></div>
</div>
<p>defines the type of two-dimensional rectangular domains
that are mapped using a Block distribution.</p>
</div></blockquote>
<p>The following syntactic sugar is provided within the <code class="docutils literal notranslate"><span class="pre">dmapped</span></code> clause.
If a <code class="docutils literal notranslate"><span class="pre">dmapped</span></code> clause starts with the name of a distribution record, it
is considered to be an initialization expression as if preceded by
<code class="docutils literal notranslate"><span class="pre">new</span></code>.</p>
<blockquote>
<div><p><em>Example</em>.</p>
<p>The code</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">BlockDist</span><span class="p">;</span>
<span class="kd">type</span> <span class="nx">BlockDom</span> <span class="o">=</span> <span class="k">domain</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">dmapped</span> <span class="nx">blockDist</span><span class="p">({</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="o">..</span><span class="mi">6</span><span class="p">});</span>
</pre></div>
</div>
<p>is equivalent to</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">BlockDist</span><span class="p">;</span>
<span class="kd">type</span> <span class="nx">BlockDom</span> <span class="o">=</span> <span class="k">domain</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">dmapped</span> <span class="k">new</span> <span class="nx">blockDist</span><span class="p">({</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="o">..</span><span class="mi">6</span><span class="p">});</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="distributions-for-domain-values">
<span id="domain-maps-for-values"></span><h2>Distributions for Domain Values<a class="headerlink" href="#distributions-for-domain-values" title="Permalink to this headline">¶</a></h2>
<p>A domain value is always mapped using the distribution of that value’s
type. The type inferred for a domain literal
(see <a class="reference internal" href="domains.html#rectangular-domain-values"><span class="std std-ref">Rectangular Domain Values</span></a>) has a default distribution.</p>
<blockquote>
<div><p><em>Example</em>.</p>
<p>In the following code</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">BlockDist</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">MyDomLiteral</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="o">..</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="p">};</span>
<span class="kd">var</span> <span class="nx">MyBlockedDom</span><span class="p">:</span> <span class="k">domain</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">dmapped</span> <span class="nx">blockDist</span><span class="p">({</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="o">..</span><span class="mi">6</span><span class="p">})</span> <span class="o">=</span> <span class="nx">MyDomLiteral</span><span class="p">;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">MyDomLiteral</span></code> is a domain literal and so will be mapped using
a default distribution. MyBlockedDom is given a type explicitly,
therefore it will be mapped using a Block distribution.</p>
</div></blockquote>
<p>A domain value’s distribution can be specified explicitly with a <code class="docutils literal notranslate"><span class="pre">dmapped</span></code>
clause, in the same way as a domain type’s distribution.</p>
<div class="highlight-syntax notranslate"><div class="highlight"><pre><span></span>mapped-domain-expression:
  domain-expression &#39;dmapped&#39; distribution-record
</pre></div>
</div>
<blockquote>
<div><p><em>Example</em>.</p>
<p>In the following code</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">BlockDist</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">MyBlockedDomLiteral1</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="o">..</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="p">}</span> <span class="k">dmapped</span> <span class="k">new</span> <span class="nx">blockDist</span><span class="p">({</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="o">..</span><span class="mi">6</span><span class="p">});</span>
<span class="kd">var</span> <span class="nx">MyBlockedDomLiteral2</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="o">..</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="p">}</span> <span class="k">dmapped</span> <span class="nx">blockDist</span><span class="p">({</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="o">..</span><span class="mi">6</span><span class="p">});</span>
</pre></div>
</div>
<p>both <code class="docutils literal notranslate"><span class="pre">MyBlockedDomLiteral1</span></code> and <code class="docutils literal notranslate"><span class="pre">MyBlockedDomLiteral2</span></code> will be
mapped using a Block distribution.</p>
</div></blockquote>
</div>
<div class="section" id="distributions-for-arrays">
<span id="domain-maps-for-arrays"></span><h2>Distributions for Arrays<a class="headerlink" href="#distributions-for-arrays" title="Permalink to this headline">¶</a></h2>
<p>Each array is mapped using the distribution of the domain over which the
array was declared.</p>
<blockquote>
<div><p><em>Example</em>.</p>
<p>In the code</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">BlockDist</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">Dom</span><span class="p">:</span> <span class="k">domain</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">dmapped</span> <span class="nx">blockDist</span><span class="p">({</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="o">..</span><span class="mi">6</span><span class="p">})</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="o">..</span><span class="mi">6</span><span class="p">};</span>
<span class="kd">var</span> <span class="nx">MyArray</span><span class="p">:</span> <span class="p">[</span><span class="nx">Dom</span><span class="p">]</span> <span class="kt">real</span><span class="p">;</span>
</pre></div>
</div>
<p>the distribution used for <code class="docutils literal notranslate"><span class="pre">MyArray</span></code> is the Block distribution from
the type of <code class="docutils literal notranslate"><span class="pre">Dom</span></code>.</p>
</div></blockquote>
</div>
<div class="section" id="distributions-are-not-retained-upon-domain-assignment">
<span id="domain-maps-not-assigned"></span><h2>Distributions Are Not Retained upon Domain Assignment<a class="headerlink" href="#distributions-are-not-retained-upon-domain-assignment" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="domains.html#domain-assignment"><span class="std std-ref">Domain assignment</span></a> transfers only the
index set of the right-hand side expression. The implementation of the
left-hand side domain expression, including its distribution, is
determined by its type and so does not change upon a domain assignment.</p>
<blockquote>
<div><p><em>Example</em>.</p>
<p>In the code</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">BlockDist</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">Dom1</span><span class="p">:</span> <span class="k">domain</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">dmapped</span> <span class="nx">blockDist</span><span class="p">({</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="o">..</span><span class="mi">6</span><span class="p">})</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="o">..</span><span class="mi">6</span><span class="p">};</span>
<span class="kd">var</span> <span class="nx">Dom2</span><span class="p">:</span> <span class="k">domain</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="nx">Dom1</span><span class="p">;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Dom2</span></code> is mapped using a default distribution, despite <code class="docutils literal notranslate"><span class="pre">Dom1</span></code>
having a Block distribution.</p>
</div></blockquote>
<blockquote>
<div><p><em>Example</em>.</p>
<p>In the code</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">BlockDist</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">Dom1</span><span class="p">:</span> <span class="k">domain</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">dmapped</span> <span class="nx">blockDist</span><span class="p">({</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="o">..</span><span class="mi">6</span><span class="p">})</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="o">..</span><span class="mi">6</span><span class="p">};</span>
<span class="kd">var</span> <span class="nx">Dom2</span> <span class="o">=</span> <span class="nx">Dom1</span><span class="p">;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Dom2</span></code> is mapped using the same distribution as <code class="docutils literal notranslate"><span class="pre">Dom1</span></code>. This is
because the declaration of <code class="docutils literal notranslate"><span class="pre">Dom2</span></code> lacks an explicit type specifier
and so its type is defined to be the type of its initialization
expression, <code class="docutils literal notranslate"><span class="pre">Dom1</span></code>. So in this situation the effect is that the
distribution does transfer upon initialization.</p>
</div></blockquote>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="locales.html" class="btn btn-neutral float-left" title="Locales" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="memory-consistency-model.html" class="btn btn-neutral float-right" title="Memory Consistency Model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Hewlett Packard Enterprise Development LP.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 



</body>
</html>