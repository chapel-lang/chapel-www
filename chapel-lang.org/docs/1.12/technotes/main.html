

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Support for main() Functions &mdash; Chapel Documentation 1.12 1.12.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
  

  
    <link rel="top" title="Chapel Documentation 1.12 1.12.0 documentation" href="../index.html"/>
        <link rel="up" title="Technical Notes" href="index.html"/>
        <link rel="next" title="Module Search Paths" href="module_search.html"/>
        <link rel="prev" title="Locale Models" href="localeModels.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> Chapel Documentation</a>
        
        
<?php   // Variables given by sphinx 
   $chplTitle = "1.12";   $pagename = "./technotes/main";   include "../versionButton.php";   ?>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/README.html">Quickstart Instructions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../usingchapel/README.html#quick-start-instructions">Quick Start Instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usingchapel/README.html#what-s-next">What&#8217;s next?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/index.html">Using Chapel</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../usingchapel/prereqs.html">Chapel Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usingchapel/chplenv.html">Setting up Your Environment for Chapel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usingchapel/building.html">Building Chapel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usingchapel/compiling.html">Compiling Chapel Programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usingchapel/executing.html">Executing Chapel Programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usingchapel/multilocale.html">Multilocale Chapel Execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usingchapel/launcher.html">Chapel Launchers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usingchapel/tasks.html">Chapel Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usingchapel/debugging.html">Debugging Chapel Programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usingchapel/bugs.html">Reporting Chapel Bugs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/index.html">Platform-Specific Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../platforms/cray.html">Using Chapel on Cray Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../platforms/cygwin.html">Using Chapel on Cygwin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../platforms/ibm.html">Using Chapel on IBM Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../platforms/knc.html">Using Chapel on Intel Xeon Phi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../platforms/macosx.html">Using Chapel on Mac OS X</a></li>
<li class="toctree-l2"><a class="reference internal" href="../platforms/marenostrum.html">Using Chapel on MareNostrum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../platforms/sgi.html">Using Chapel on SGI Altix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/builtins.html">Built-in Types and Functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/internal/Atomics.html">Atomics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/internal/ChapelArray.html">Domain and Array Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/internal/ChapelComplex_forDocs.html">Complex</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/internal/ChapelIO.html">IO Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/internal/ChapelIteratorSupport.html">Vectorizing Iterator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/internal/ChapelLocale.html">Locales</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/internal/ChapelRange.html">Ranges</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/internal/ChapelSyncvar.html">Synchronization Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/internal/ChapelTuple.html">Tuples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/internal/UtilMisc_forDocs.html">Misc Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/standardlibrary.html">Standard Library</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/modules.html">Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/distributions.html">Distributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/layouts.html">Layouts</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Technical Notes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="allocators.html">Chapel&#8217;s Use of Allocators</a></li>
<li class="toctree-l2"><a class="reference internal" href="atomics.html">Runtime Support for Atomics</a></li>
<li class="toctree-l2"><a class="reference internal" href="auxIO.html">Auxiliary I/O Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="chpl-ipe.html">Interactive Chapel</a></li>
<li class="toctree-l2"><a class="reference internal" href="chpldoc.html">Documenting Chapel</a></li>
<li class="toctree-l2"><a class="reference internal" href="dsi.html">Domain Map Standard Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="extern.html">C Interoperability</a></li>
<li class="toctree-l2"><a class="reference internal" href="firstClassFns.html">First-class Functions in Chapel</a></li>
<li class="toctree-l2"><a class="reference internal" href="libraries.html">Exporting Chapel as a Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="llvm.html">LLVM Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="local.html">The &#8216;local&#8217; Statement</a></li>
<li class="toctree-l2"><a class="reference internal" href="localeModels.html">Locale Models</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Support for main() Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="module_search.html">Module Search Paths</a></li>
<li class="toctree-l2"><a class="reference internal" href="reduceIntents.html">Reduce Intents</a></li>
<li class="toctree-l2"><a class="reference internal" href="sets.html">Associative Set Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="subquery.html">Querying a Local Subdomain</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tools/chplvis/index.html">chplvis</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Chapel Documentation 1.12</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Technical Notes</a> &raquo;</li>
      
    <li>Support for main() Functions</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/technotes/main.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="support-for-main-functions">
<span id="readme-main"></span><h1>Support for main() Functions<a class="headerlink" href="#support-for-main-functions" title="Permalink to this headline">¶</a></h1>
<p>After running module initialization code (top-level statements in
modules), a Chapel program will start executing from the entry point,
a function named main().  Chapel&#8217;s main() function has typically taken
no arguments and had to return type.  This README describes initial
support for returning a status value and making main() take arbitrary
command-line arguments.</p>
<div class="section" id="returning-a-status-value">
<h2>Returning a status value<a class="headerlink" href="#returning-a-status-value" title="Permalink to this headline">¶</a></h2>
<p>Traditionally, the only way to return a nonzero exit value from a
Chapel program has been to call exit().  Optionally, main() can be
declared to return an integer in which case the value returned serves
as the status value.</p>
</div>
<div class="section" id="having-main-accept-command-line-arguments">
<h2>Having main() accept command-line arguments<a class="headerlink" href="#having-main-accept-command-line-arguments" title="Permalink to this headline">¶</a></h2>
<div class="section" id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>Because Chapel programs have traditionally accepted a number of
&#8220;built-in&#8221; flags and configuration variables, there has been no way to
create a Chapel program that accepts arguments like an arbitrary list
of filenames or flags that might conflict with built-in capabilities.
For most uses, Chapel&#8217;s existing config variable support is useful and
easy; occasionally, however, one wants to fully control argument
processing.</p>
<p>If a progam&#8217;s main() function is declared to take no arguments, Chapel
will behave as it traditionally has &#8211; built-in flags and config
settings will be handled and unrecognized flags will trigger an error.</p>
<p>Alternatively, a main() function can be declared to take an array of
strings as an argument.  By doing so, the program opts-in to explicit
argument handling, described in the remainder of this README.</p>
</div>
<div class="section" id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h3>
<p>To use this feature, declare main as follows:</p>
<div class="highlight-chapel"><div class="highlight"><pre><span class="k">proc</span> <span class="nf">main</span><span class="p">(</span><span class="nx">args</span><span class="p">:</span> <span class="p">[]</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...body...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When main is so declared, Chapel&#8217;s default command line argument
processing changes. Rather than generate an error message when an
unknown argument is encountered, that argument will instead be passed
on to this main(args) function. Arguments corresponding to config
variables or Chapel&#8217;s predefined flags (like <tt class="docutils literal"><span class="pre">-nl</span></tt>, <tt class="docutils literal"><span class="pre">-b</span></tt>, etc) will still
be processed and will not be passed on to the main(args) function.</p>
<p>To be clear, the arguments that would be handled without using this
feature will continue to behave as usual. The difference is that other
arguments will be passed to main(args) rather than generating an error
message. The only exception to this, is <tt class="docutils literal"><span class="pre">--help</span></tt> and <tt class="docutils literal"><span class="pre">-h</span></tt>.</p>
<p>Prior to this feature, a Chapel program would always exit immediately
after printing the help message. A programmer might want to print
other information explaining what non-config-var command line
arguments are available and what they might do. For this reason, when
a Chapel program includes a main declared to take arguments, <tt class="docutils literal"><span class="pre">--help</span></tt>
and <tt class="docutils literal"><span class="pre">-h</span></tt> will be passed on to the main(args) function.  The function
Help.printUsage() will print out the familiar config var table.</p>
<p>To gain access to this new function requires a module:</p>
<p><tt class="docutils literal"><span class="pre">use</span> <span class="pre">Help;</span></tt></p>
<p>From that module, the function printDefaultUsage() is available. For
example, consider the following program:</p>
<div class="highlight-chapel"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Help</span><span class="p">;</span>

<span class="k">proc</span> <span class="nf">main</span><span class="p">(</span><span class="nx">args</span><span class="p">:</span> <span class="p">[]</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="nx">a</span> <span class="kd">in</span> <span class="nx">args</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">a</span><span class="o">==</span><span class="s">&quot;--help&quot;</span> <span class="p">{</span>
      <span class="nx">printUsage</span><span class="p">();</span>
      <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;\nEXTRA ARGUMENTS:&quot;</span><span class="p">);</span>
      <span class="nx">writeln</span><span class="p">(</span>  <span class="s">&quot;================&quot;</span><span class="p">);</span>
      <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;You can provide an arbitrary list of filenames.&quot;</span><span class="p">);</span>
      <span class="nx">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This program scans its argument list for <tt class="docutils literal"><span class="pre">--help</span></tt>, and if found, it
prints the standard usage message as well as some additional text
explaining the purpose of the extra arguments. Note that this could be
used by a program which simply wants to add explanatory text to the
<tt class="docutils literal"><span class="pre">--help</span></tt> output without actually handling any additional arguments.</p>
<p>Finally, as is common in GNU programs, there is a way to suspend
argument processing when main is declared to take arguments. Suppose
you are writing <tt class="docutils literal"><span class="pre">rm</span></tt> in Chapel and need to delete a file named
<tt class="docutils literal"><span class="pre">--memTrack=true</span></tt>. Your program will consume this flag during startup,
rather than passing it on to the declared main function. However,
placing the argument <tt class="docutils literal"><span class="pre">--</span></tt> in the argument list will cause all
following arguments to be passed to the declared main function and
will suspend handling of any builtin command line
arguments. Specifically, if a.out is a Chapel program which has
declared main to take arguments:</p>
<p><tt class="docutils literal"><span class="pre">./a.out</span> <span class="pre">--</span> <span class="pre">--memTrack=true</span></tt></p>
<p>will result in the program receiving <tt class="docutils literal"><span class="pre">--memTrack=true</span></tt> as the first
argument after the executable name.</p>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="module_search.html" class="btn btn-neutral float-right" title="Module Search Paths">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="localeModels.html" class="btn btn-neutral" title="Locale Models"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Cray Inc.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.12.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 

</body>
</html>
