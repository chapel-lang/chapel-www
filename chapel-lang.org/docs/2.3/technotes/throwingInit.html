<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Throwing Initializers &mdash; Chapel Documentation 2.3</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/style.css?v=70f659a1" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=c3c8ae58"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Domain Map Standard Interface" href="dsi.html" />
    <link rel="prev" title="Partial Instantiations" href="partialInstantiations.html" />
   
  

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

<a href="../index.html" class="icon icon-home"> Chapel Documentation

<!-- display version if button won't be rendered -->
<?php if (false) { ?>
<br>2.3
<?php } ?>

</a>

<?php
// Variables given by sphinx
$chplTitle = "2.3";
$pagename = "technotes/throwingInit";
include "..//versionButton.php";
?>


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
              <p class="caption" role="heading"><span class="caption-text">Compiling and Running Chapel</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/QUICKSTART.html">Quickstart Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/index.html">Using Chapel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/index.html">Platform-Specific Notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Technical Notes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#base-language-features">Base Language Features</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#initializers-and-generic-programming">Initializers and Generic Programming</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="forwarding.html">Forwarding Methods Calls</a></li>
<li class="toctree-l3"><a class="reference internal" href="initequals.html">The ‘init=’ Method</a></li>
<li class="toctree-l3"><a class="reference internal" href="initTypeAlias.html">Invoking Initializers with a Generic Instantiation</a></li>
<li class="toctree-l3"><a class="reference internal" href="partialInstantiations.html">Partial Instantiations</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Throwing Initializers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#future-work">Future Work</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#parallel-language-features">Parallel Language Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#interoperability">Interoperability</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#io">IO</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#compiler-features">Compiler Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#tool-details">Tool Details</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Docs for Contributors</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Writing Chapel Programs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../language/reference.html">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Hello World Variants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../primers/index.html">Primers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/spec/index.html">Language Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/standard.html">Standard Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/packages.html">Package Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/layoutdist.html">Standard Layouts and Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mason-packages/index.html">Mason Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users-guide/index.html">Chapel Users Guide (WIP)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Language History</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../language/evolution.html">Chapel Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/archivedSpecs.html">Documentation Archives</a></li>
</ul>

  <p class="caption" role="heading"><span class="caption-text">Indexes</span></p>
  <ul>
    <li class="toctree-11"><a class="reference internal" href="../chpl-modindex.html">Chapel Module Index</a></li>
    <li class="toctree-11"><a class="reference internal" href="../genindex.html">Complete Docs Index</a></li>
  </ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Chapel Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Technical Notes</a></li>
      <li class="breadcrumb-item active">Throwing Initializers</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/technotes/throwingInit.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="throwing-initializers">
<span id="readme-throwing-initializers"></span><h1>Throwing Initializers<a class="headerlink" href="#throwing-initializers" title="Link to this heading">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>Initializers (see <a class="reference internal" href="../language/spec/classes.html#class-initializers"><span class="std std-ref">Class Initializers</span></a>) and <a class="reference internal" href="../language/spec/error-handling.html#chapter-error-handling"><span class="std std-ref">Error Handling</span></a>
are currently in the process of being integrated together.  Support for the
overlap of these features is currently limited, but key functionality has been
enabled.</p>
<section id="using-catch-less-try">
<h3>Using Catch-less try!<a class="headerlink" href="#using-catch-less-try" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">try!</span></code> can be used anywhere in the body of any initializer, so long as it does
not have an associated <code class="docutils literal notranslate"><span class="pre">catch</span></code> clause.  When used, any error encountered will
cause the program to halt.</p>
<p><em>Example (try-bang-init.chpl)</em>.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">throwingFunc</span><span class="p">(</span><span class="nx">x</span><span class="p">:</span> <span class="kt">int</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">Error</span><span class="p">(</span><span class="s">&quot;x too large&quot;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">record</span> <span class="nc">Foo</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">x</span><span class="p">:</span> <span class="kt">int</span><span class="p">;</span>

  <span class="k">proc</span> <span class="nf">init</span><span class="p">(</span><span class="nx">xVal</span><span class="p">:</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">x</span> <span class="o">=</span> <span class="k">try</span><span class="o">!</span> <span class="nx">throwingFunc</span><span class="p">(</span><span class="nx">xVal</span><span class="p">);</span> <span class="c1">// try! here is legal</span>
    <span class="cm">/* The following code is not legal in an initializer yet, due to</span>
<span class="cm">       having a catch clause:</span>

<span class="cm">      try! {</span>
<span class="cm">        x = throwingFunc(xVal);</span>
<span class="cm">      } catch e: Error {</span>
<span class="cm">        x = 9;</span>
<span class="cm">      }</span>
<span class="cm">    */</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="declaring-initializers-as-throws">
<span id="init-declaring-init-as-throws"></span><h3>Declaring Initializers as throws<a class="headerlink" href="#declaring-initializers-as-throws" title="Link to this heading">¶</a></h3>
<p>Initializers can be declared with the <code class="docutils literal notranslate"><span class="pre">throws</span></code> keyword.  This enables uncaught
errors in the initializer body to be propagated outside of the initializer (see
<a class="reference internal" href="#init-calling-throwing-funcs"><span class="std std-ref">Calling Throwing Functions</span></a>).  When an error is thrown, the memory that
would have been used for the result of the initializer call will be cleaned up
before the error is thrown back to the caller.</p>
<p><em>Example (init-declared-throws.chpl)</em>.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">validate</span><span class="p">(</span><span class="nx">r</span><span class="p">:</span> <span class="nx">R</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">Error</span><span class="p">(</span><span class="s">&quot;x too large&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">record</span> <span class="nc">R</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">x</span><span class="p">:</span> <span class="kt">int</span><span class="p">;</span>

  <span class="k">proc</span> <span class="nf">init</span><span class="p">(</span><span class="nx">xVal</span><span class="p">:</span> <span class="kt">int</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="nx">x</span> <span class="o">=</span> <span class="nx">xVal</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">complete</span><span class="p">();</span>
    <span class="nx">validate</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="calling-throwing-functions">
<span id="init-calling-throwing-funcs"></span><h3>Calling Throwing Functions<a class="headerlink" href="#calling-throwing-functions" title="Link to this heading">¶</a></h3>
<p>When an initializer is declared with the <code class="docutils literal notranslate"><span class="pre">throws</span></code> keyword, calls to throwing
functions may be made in the body of the initializer after <code class="docutils literal notranslate"><span class="pre">this.complete()</span></code>
(see <a class="reference internal" href="../language/spec/classes.html#limitations-on-instance-usage-in-initializers"><span class="std std-ref">Limitations on Instance Usage in Initializers</span></a> for information on
<code class="docutils literal notranslate"><span class="pre">this.complete()</span></code> and the example in <a class="reference internal" href="#init-declaring-init-as-throws"><span class="std std-ref">Declaring Initializers as throws</span></a>).
As a result, thrown errors will be propagated outside of the initializer.  The
memory that would have been used to store the instance created by the
initializer will be cleaned up prior to propagating the error.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Calls to throwing functions are not currently allowed prior to
<code class="docutils literal notranslate"><span class="pre">this.complete()</span></code>.</p>
</div>
<p>When an initializer is not declared with the <code class="docutils literal notranslate"><span class="pre">throws</span></code> keyword, calls to
throwing functions may be made anywhere in the body of the initializer.  Such
calls will cause the program to halt (see <a class="reference internal" href="../language/spec/error-handling.html#chapter-error-handling"><span class="std std-ref">Error Handling</span></a>) if
errors are encountered.</p>
</section>
</section>
<section id="future-work">
<h2>Future Work<a class="headerlink" href="#future-work" title="Link to this heading">¶</a></h2>
<p>We intend to fully support throwing initializers in the future.  This will
include:</p>
<ul>
<li><p>being able to <code class="docutils literal notranslate"><span class="pre">throw</span></code> from anywhere in the body of an initializer</p></li>
<li><p>being able to write <code class="docutils literal notranslate"><span class="pre">try</span></code> / <code class="docutils literal notranslate"><span class="pre">try!</span></code> with <code class="docutils literal notranslate"><span class="pre">catch</span></code> blocks anywhere in the
body of an initializer</p></li>
<li><p>being able to call functions that <code class="docutils literal notranslate"><span class="pre">throw</span></code> prior to <code class="docutils literal notranslate"><span class="pre">this.complete()</span></code>
(see <a class="reference internal" href="../language/spec/classes.html#limitations-on-instance-usage-in-initializers"><span class="std std-ref">Limitations on Instance Usage in Initializers</span></a> for a description)
- including <code class="docutils literal notranslate"><span class="pre">super.init</span></code> calls when the parent initializer throws, e.g.,</p>
<blockquote>
<div><div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">x</span><span class="p">:</span> <span class="kt">int</span><span class="p">;</span>

  <span class="k">proc</span> <span class="nf">init</span><span class="p">(</span><span class="nx">xVal</span><span class="p">:</span> <span class="kt">int</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="nx">x</span> <span class="o">=</span> <span class="nx">xVal</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">complete</span><span class="p">();</span>
    <span class="nx">someThrowingFunc</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">B</span> <span class="p">:</span> <span class="nx">A</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">y</span><span class="p">:</span> <span class="kt">bool</span><span class="p">;</span>

  <span class="k">proc</span> <span class="nf">init</span><span class="p">(</span><span class="nx">xVal</span><span class="p">:</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">yVal</span><span class="p">:</span> <span class="kt">bool</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="nx">super</span><span class="p">.</span><span class="k">init</span><span class="p">(</span><span class="nx">xVal</span><span class="p">);</span> <span class="c1">// This call is not valid today</span>
    <span class="nx">y</span> <span class="o">=</span> <span class="nx">yVal</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">complete</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="partialInstantiations.html" class="btn btn-neutral float-left" title="Partial Instantiations" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="dsi.html" class="btn btn-neutral float-right" title="Domain Map Standard Interface" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Hewlett Packard Enterprise Development LP.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 



</body>
</html>