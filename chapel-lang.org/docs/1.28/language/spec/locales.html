<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Locales &mdash; Chapel Documentation 1.28</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/style.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Domain Maps" href="domain-maps.html" />
    <link rel="prev" title="Data Parallelism" href="data-parallelism.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

<a href="../../index.html" class="icon icon-home"> Chapel Documentation

<!-- display version if button won't be rendered -->
<?php if (false) { ?>
<br>1.28
<?php } ?>

</a>

<?php
// Variables given by sphinx
$chplTitle = "1.28";
$pagename = "language/spec/locales";
include "../..//versionButton.php";
?>


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
              <p class="caption" role="heading"><span class="caption-text">Compiling and Running Chapel</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usingchapel/QUICKSTART.html">Quickstart Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usingchapel/index.html">Using Chapel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../platforms/index.html">Platform-Specific Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../technotes/index.html">Technical Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">Docs for Contributors</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Writing Chapel Programs</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Hello World Variants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../primers/index.html">Primers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Language Specification</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#introductory-material">Introductory Material</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#language-basics">Language Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#code-structures">Code Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#composite-types">Composite Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#generic-programming">Generic Programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#parallel-programming">Parallel Programming</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#distributed-programming">Distributed Programming</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Locales</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Locales</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-on-statement">The On Statement</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="domain-maps.html">Domain Maps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#additional-topics">Additional Topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#appendices">Appendices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../builtins/index.html">Built-in Types and Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/standard.html">Standard Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/packages.html">Package Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/layoutdist.html">Standard Layouts and Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mason-packages/index.html">Mason Packages (WIP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../users-guide/index.html">Chapel Users Guide (WIP)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Language History</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../evolution.html">Chapel Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../archivedSpecs.html">Documentation Archives</a></li>
</ul>

  <p class="caption" role="heading"><span class="caption-text">Indexes</span></p>
  <ul>
    <li class="toctree-11"><a class="reference internal" href="../../chpl-modindex.html">Chapel Module Index</a></li>
    <li class="toctree-11"><a class="reference internal" href="../../genindex.html">Complete Docs Index</a></li>
  </ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Chapel Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Chapel Language Specification</a> &raquo;</li>
      <li>Locales</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/language/spec/locales.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="locales">
<span id="chapter-locales-chapter"></span><h1>Locales<a class="headerlink" href="#locales" title="Permalink to this headline">¶</a></h1>
<p>Chapel provides high-level abstractions that allow programmers to
exploit locality by controlling the affinity of both data and tasks to
abstract units of processing and storage capabilities called <em>locales</em>.
The <em>on-statement</em> allows for the migration of tasks to <em>remote</em>
locales.</p>
<p>Throughout this section, the term <em>local</em> will be used to describe the
locale on which a task is running, the data located on this locale, and
any tasks running on this locale. The term <em>remote</em> will be used to
describe another locale, the data on another locale, and the tasks
running on another locale.</p>
<div class="section" id="id1">
<span id="id2"></span><h2>Locales<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>A <em>locale</em> is a Chapel abstraction for a piece of a target architecture
that has processing and storage capabilities.  Generally speaking, the
tasks running within a locale have roughly uniform access to values
stored in the locale’s local memory and longer latencies for accessing
the memories of other locales.  As an example, a single shared memory
machine would be defined as a single locale. In contrast, a cluster of
network-connected multicore nodes would have a locale for each node.</p>
<div class="section" id="locale-types">
<span id="the-locale-type"></span><h3>Locale Types<a class="headerlink" href="#locale-types" title="Permalink to this headline">¶</a></h3>
<p>The identifier <code class="docutils literal notranslate"><span class="pre">locale</span></code> is a type that abstracts a locale as described above.
Both data and tasks can be associated with a value of locale type.</p>
<p>The default value for a variable with <code class="docutils literal notranslate"><span class="pre">locale</span></code> type is <code class="docutils literal notranslate"><span class="pre">Locales[0]</span></code>.</p>
</div>
<div class="section" id="locale-methods">
<span id="id3"></span><h3>Locale Methods<a class="headerlink" href="#locale-methods" title="Permalink to this headline">¶</a></h3>
<p>The locale type supports the following methods:</p>
<dl class="chpl method">
<dt class="sig sig-object chpl" id="ChapelLocale.locale.hostname">
<em class="property"><span class="pre">proc</span> </em><span class="sig-prename descclassname"><span class="pre">locale.</span></span><span class="sig-name descname"><span class="pre">hostname</span></span><span class="pre">:</span> <span class="pre">string</span><a class="headerlink" href="#ChapelLocale.locale.hostname" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the hostname of this locale.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>the hostname of the compute node associated with the locale</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>string</p>
</dd>
</dl>
</dd></dl>

<dl class="chpl method">
<dt class="sig sig-object chpl" id="ChapelLocale.locale.name">
<em class="property"><span class="pre">proc</span> </em><span class="sig-prename descclassname"><span class="pre">locale.</span></span><span class="sig-name descname"><span class="pre">name</span></span><span class="pre">:</span> <span class="pre">string</span><a class="headerlink" href="#ChapelLocale.locale.name" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>Get the name of this locale.</p>
<p>In general, this method returns the same string as <a class="reference internal" href="#ChapelLocale.locale.hostname" title="ChapelLocale.locale.hostname"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">locale.hostname</span></code></a>;
however, it can differ when the program is executed in an oversubscribed manner.</p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The locale’s <cite>id</cite> (from <a class="reference internal" href="#ChapelLocale.locale.id" title="ChapelLocale.locale.id"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">locale.id</span></code></a>) will be appended to the <cite>hostname</cite>
when launching in an oversubscribed manner with <cite>CHPL_COMM=gasnet</cite> and one of
the following configurations:</p>
<ul class="simple">
<li><p><cite>CHPL_COMM_SUBSTRATE=udp</cite> &amp; <cite>GASNET_SPAWNFN=L</cite></p></li>
<li><p><cite>CHPL_COMM_SUBSTRATE=smp</cite></p></li>
</ul>
<p>More information about these environment variables can be found here: <a class="reference internal" href="../../usingchapel/multilocale.html#readme-multilocale"><span class="std std-ref">Multilocale Chapel Execution</span></a></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>the name of this locale</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>string</p>
</dd>
</dl>
</dd></dl>

<dl class="chpl method">
<dt class="sig sig-object chpl" id="ChapelLocale.locale.id">
<em class="property"><span class="pre">proc</span> </em><span class="sig-prename descclassname"><span class="pre">locale.</span></span><span class="sig-name descname"><span class="pre">id</span></span><span class="pre">:</span> <span class="pre">int</span><a class="headerlink" href="#ChapelLocale.locale.id" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the unique integer identifier for this locale.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>index of this locale in the range <code class="docutils literal notranslate"><span class="pre">0..numLocales-1</span></code></p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="chpl method">
<dt class="sig sig-object chpl" id="ChapelLocale.locale.maxTaskPar">
<em class="property"><span class="pre">proc</span> </em><span class="sig-prename descclassname"><span class="pre">locale.</span></span><span class="sig-name descname"><span class="pre">maxTaskPar</span></span><span class="pre">:</span> <span class="pre">int</span><a class="headerlink" href="#ChapelLocale.locale.maxTaskPar" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the maximum task concurrency that one can expect to
achieve on this locale.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>the maximum number of tasks that can run in parallel
on this locale</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>int</p>
</dd>
</dl>
<p>Note that the value is an estimate by the runtime tasking layer.
Typically it is the number of physical processor cores available
to the program.  Executing a data-parallel construct with more
tasks this that is unlikely to improve performance.</p>
</dd></dl>

<dl class="chpl method">
<dt class="sig sig-object chpl" id="ChapelLocale.locale.numPUs">
<em class="property"><span class="pre">proc</span> </em><span class="sig-prename descclassname"><span class="pre">locale.</span></span><span class="sig-name descname"><span class="pre">numPUs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">logical:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">false</span></em>, <em class="sig-param"><span class="pre">accessible:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">true</span></em><span class="sig-paren">)</span><span class="pre">:</span> <span class="pre">int</span><a class="headerlink" href="#ChapelLocale.locale.numPUs" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the number of processing units available on this locale.</p>
<p>A <em>processing unit</em> or <em>PU</em> is an instance of the processor
architecture, basically the thing that executes instructions.
<a class="reference internal" href="#ChapelLocale.locale.numPUs" title="ChapelLocale.locale.numPUs"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">locale.numPUs</span></code></a> tells how many of these are present on this
locale.  It can count either physical PUs (commonly known as
<em>cores</em>) or hardware threads such as hyperthreads and the like.
It can also either take into account any OS limits on which PUs
the program has access to or do its best to ignore such limits.
By default it returns the number of accessible physical cores.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>logical</strong> : <cite>bool</cite> – Count logical PUs (hyperthreads and the like),
or physical ones (cores)?  Defaults to <cite>false</cite>,
for cores.</p></li>
<li><p><strong>accessible</strong> : <cite>bool</cite> – Count only PUs that can be reached, or all of
them?  Defaults to <cite>true</cite>, for accessible PUs.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>number of PUs</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>int</cite></p>
</dd>
</dl>
<p>Note that there are several things that can cause the OS to limit
the processor resources available to a Chapel program.  On plain
Linux systems using the <code class="docutils literal notranslate"><span class="pre">taskset(1)</span></code> command will do it.  On
Cray systems the <code class="docutils literal notranslate"><span class="pre">CHPL_LAUNCHER_CORES_PER_LOCALE</span></code> environment
variable may do it, indirectly via the system job launcher.
Also on Cray systems, using a system job launcher (<code class="docutils literal notranslate"><span class="pre">aprun</span></code> or
<code class="docutils literal notranslate"><span class="pre">slurm</span></code>) to run a Chapel program manually may do it, as can
running programs within Cray batch jobs that have been set up
with limited processor resources.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>‘locale.numPUs’ is unstable</p>
</div>
</dd></dl>

<dl class="chpl method">
<dt class="sig sig-object chpl" id="ChapelLocale.locale.callStackSize">
<em class="property"><span class="pre">proc</span> </em><span class="sig-prename descclassname"><span class="pre">locale.</span></span><span class="sig-name descname"><span class="pre">callStackSize</span></span><a class="headerlink" href="#ChapelLocale.locale.callStackSize" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">callStackSize</span></code> holds the size of a task stack on a given
locale.  Thus, <code class="docutils literal notranslate"><span class="pre">here.callStackSize</span></code> is the size of the call
stack for any task on the current locale, including the
caller.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>‘locale.callStackSize’ is deprecated.</p>
</div>
</dd></dl>

<dl class="chpl method">
<dt class="sig sig-object chpl" id="ChapelLocale.locale.runningTasks">
<em class="property"><span class="pre">proc</span> </em><span class="sig-prename descclassname"><span class="pre">locale.</span></span><span class="sig-name descname"><span class="pre">runningTasks</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><span class="pre">:</span> <span class="pre">int</span><a class="headerlink" href="#ChapelLocale.locale.runningTasks" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the number of tasks running on this locale.</p>
<p>This method is intended to guide task creation during a parallel
section. If the number of running tasks is greater than or equal
to the locale’s maximum task parallelism (queried via <a class="reference internal" href="#ChapelLocale.locale.maxTaskPar" title="ChapelLocale.locale.maxTaskPar"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">locale.maxTaskPar</span></code></a>),
then creating more tasks is unlikely to decrease walltime.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>the number of tasks that have begun executing, but have not yet finished</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><cite>int</cite></p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="the-predefined-locales-array">
<span id="predefined-locales-array"></span><h3>The Predefined Locales Array<a class="headerlink" href="#the-predefined-locales-array" title="Permalink to this headline">¶</a></h3>
<p>Chapel provides a predefined environment that stores information about
the locales used during program execution. This <em>execution environment</em>
contains definitions for the array of locales on which the program is
executing (<code class="docutils literal notranslate"><span class="pre">Locales</span></code>), a domain for that array (<code class="docutils literal notranslate"><span class="pre">LocaleSpace</span></code>), and
the number of locales (<code class="docutils literal notranslate"><span class="pre">numLocales</span></code>).</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">config</span> <span class="kd">const</span> <span class="nx">numLocales</span><span class="p">:</span> <span class="kt">int</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">LocaleSpace</span><span class="p">:</span> <span class="k">domain</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="nx">numLocales</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
<span class="kd">const</span> <span class="nx">Locales</span><span class="p">:</span> <span class="p">[</span><span class="nx">LocaleSpace</span><span class="p">]</span> <span class="kt">locale</span><span class="p">;</span>
</pre></div>
</div>
<p>When a Chapel program starts, a single task executes <code class="docutils literal notranslate"><span class="pre">main</span></code> on
<code class="docutils literal notranslate"><span class="pre">Locales(0)</span></code>.</p>
<p>Note that the Locales array is typically defined such that distinct
elements refer to distinct resources on the target parallel
architecture. In particular, the Locales array itself should not be used
in an oversubscribed manner in which a single processor resource is
represented by multiple locale values (except during development).
Oversubscription should instead be handled by creating an aggregate of
locale values and referring to it in place of the Locales array.</p>
<blockquote>
<div><p><em>Rationale</em>.</p>
<p>This design choice encourages clarity in the program’s source text
and enables more opportunities for optimization.</p>
<p>For development purposes, oversubscription is still very useful and
this should be supported by Chapel implementations to allow
development on smaller machines.</p>
</div></blockquote>
<blockquote>
<div><p><em>Example</em>.</p>
<p>The code</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">MyLocales</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="nx">numLocales</span><span class="o">*</span><span class="mi">4</span><span class="p">]</span> <span class="kt">locale</span>
               <span class="o">=</span> <span class="p">[</span><span class="nx">loc</span> <span class="kd">in</span> <span class="mi">0</span><span class="o">..</span><span class="nx">numLocales</span><span class="o">*</span><span class="mi">4</span><span class="p">]</span> <span class="nx">Locales</span><span class="p">(</span><span class="nx">loc</span><span class="o">%</span><span class="nx">numLocales</span><span class="p">);</span>
<span class="k">on</span> <span class="nx">MyLocales</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">..</span><span class="p">.</span>
</pre></div>
</div>
<p>defines a new array <code class="docutils literal notranslate"><span class="pre">MyLocales</span></code> that is four times the size of the
<code class="docutils literal notranslate"><span class="pre">Locales</span></code> array. Each locale is added to the <code class="docutils literal notranslate"><span class="pre">MyLocales</span></code> array
four times in a round-robin fashion.</p>
</div></blockquote>
</div>
<div class="section" id="the-here-locale">
<span id="here"></span><h3>The <em>here</em> Locale<a class="headerlink" href="#the-here-locale" title="Permalink to this headline">¶</a></h3>
<p>A predefined constant locale <code class="docutils literal notranslate"><span class="pre">here</span></code> can be used anywhere in a Chapel
program. It refers to the locale that the current task is running on.</p>
<blockquote>
<div><p><em>Example</em>.</p>
<p>The code</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">on</span> <span class="nx">Locales</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="nx">here</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>results in the output <code class="docutils literal notranslate"><span class="pre">1</span></code> because the <code class="docutils literal notranslate"><span class="pre">writeln</span></code> statement is
executed on locale 1.</p>
</div></blockquote>
<p>The identifier <code class="docutils literal notranslate"><span class="pre">here</span></code> is not a keyword and can be overridden.</p>
</div>
<div class="section" id="querying-the-locale-of-an-expression">
<span id="id4"></span><h3>Querying the Locale of an Expression<a class="headerlink" href="#querying-the-locale-of-an-expression" title="Permalink to this headline">¶</a></h3>
<p>The locale associated with an expression (where the expression is
stored) is queried using the following syntax:</p>
<div class="highlight-syntax notranslate"><div class="highlight"><pre><span></span>locale-query-expression:
  expression . &#39;locale&#39;
</pre></div>
</div>
<p>When the expression is a class, the access returns the locale on which
the class object exists rather than the reference to the class. If the
expression is a value, it is considered local. The implementation may
warn about this behavior. If the expression is a locale, it is returned
directly.</p>
<blockquote>
<div><p><em>Example</em>.</p>
<p>Given a class C and a record R, the code</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">on</span> <span class="nx">Locales</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">x</span><span class="p">:</span> <span class="kt">int</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">c</span><span class="p">:</span> <span class="nx">C</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">r</span><span class="p">:</span> <span class="nx">R</span><span class="p">;</span>
  <span class="k">on</span> <span class="nx">Locales</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">on</span> <span class="nx">Locales</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">C</span><span class="p">();</span>
      <span class="nx">r</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">R</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="kt">locale</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="kt">locale</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="kt">locale</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>results in the output</p>
<div class="highlight-printoutput notranslate"><div class="highlight"><pre><span></span>1
3
1
</pre></div>
</div>
<p>The variable <code class="docutils literal notranslate"><span class="pre">x</span></code> is declared and exists on <code class="docutils literal notranslate"><span class="pre">Locales(1)</span></code>. The
variable <code class="docutils literal notranslate"><span class="pre">c</span></code> is a class reference. The reference exists on
<code class="docutils literal notranslate"><span class="pre">Locales(1)</span></code> but the object itself exists on <code class="docutils literal notranslate"><span class="pre">Locales(3)</span></code>. The
locale access returns the locale where the object exists. Lastly, the
variable <code class="docutils literal notranslate"><span class="pre">r</span></code> is a record and has value semantics. It exists on
<code class="docutils literal notranslate"><span class="pre">Locales(1)</span></code> even though it is assigned a value on a remote locale.</p>
</div></blockquote>
<p>Module-scope constants that are not distributed in nature are
replicated across all locales.</p>
<blockquote>
<div><p><em>Example</em>.</p>
<p>For example, the following code:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="k">for</span> <span class="nx">loc</span> <span class="kd">in</span> <span class="nx">Locales</span> <span class="k">do</span> <span class="k">on</span> <span class="nx">loc</span> <span class="k">do</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="kt">locale</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</pre></div>
</div>
<p>outputs</p>
<div class="highlight-printoutput notranslate"><div class="highlight"><pre><span></span>0
1
2
3
4
</pre></div>
</div>
<p>when running on 5 locales.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="the-on-statement">
<span id="on"></span><h2>The On Statement<a class="headerlink" href="#the-on-statement" title="Permalink to this headline">¶</a></h2>
<p>The on statement controls on which locale a block of code should be
executed or data should be placed. The syntax of the on statement is
given by</p>
<div class="highlight-syntax notranslate"><div class="highlight"><pre><span></span>on-statement:
  &#39;on&#39; expression &#39;do&#39; statement
  &#39;on&#39; expression block-statement
</pre></div>
</div>
<p>The locale of the expression is automatically queried as described
in <a class="reference internal" href="#querying-the-locale-of-an-expression"><span class="std std-ref">Querying the Locale of an Expression</span></a>. Execution of the
statement occurs on this specified locale and then continues after the
<code class="docutils literal notranslate"><span class="pre">on-statement</span></code>.</p>
<p>Return statements may not be lexically enclosed in on statements. Yield
statements may only be lexically enclosed in on statements in parallel
iterators <a class="reference internal" href="iterators.html#parallel-iterators"><span class="std std-ref">Parallel Iterators</span></a>.</p>
<p>One common code idiom in Chapel is the following, which spreads parallel
tasks across the network-connected locales upon which the program is running:</p>
<blockquote>
<div><div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">coforall</span> <span class="nx">loc</span> <span class="kd">in</span> <span class="nx">Locales</span> <span class="p">{</span> <span class="k">on</span> <span class="nx">loc</span> <span class="p">{</span> <span class="o">..</span><span class="p">.</span> <span class="p">}</span> <span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<div class="section" id="remote-variable-declarations">
<span id="id5"></span><h3>Remote Variable Declarations<a class="headerlink" href="#remote-variable-declarations" title="Permalink to this headline">¶</a></h3>
<p>By default, when new variables and data objects are created, they are
created in the locale where the task is running. Variables can be
defined within an <code class="docutils literal notranslate"><span class="pre">on-statement</span></code> to define them on a particular locale
such that the scope of the variables is outside the <code class="docutils literal notranslate"><span class="pre">on-statement</span></code>.
This is accomplished using a similar syntax but omitting the <code class="docutils literal notranslate"><span class="pre">do</span></code>
keyword and braces. The syntax is given by:</p>
<div class="highlight-syntax notranslate"><div class="highlight"><pre><span></span>remote-variable-declaration-statement:
  &#39;on&#39; expression variable-declaration-statement
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Support for this syntax is not yet implemented.</p>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="data-parallelism.html" class="btn btn-neutral float-left" title="Data Parallelism" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="domain-maps.html" class="btn btn-neutral float-right" title="Domain Maps" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Hewlett Packard Enterprise Development LP.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 



</body>
</html>