<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nightly Testing &mdash; Chapel Documentation 1.28</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/style.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Standard Module Style" href="StandardModuleStyle.html" />
    <link rel="prev" title="Unstable Features" href="Unstable.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

<a href="../../index.html" class="icon icon-home"> Chapel Documentation

<!-- display version if button won't be rendered -->
<?php if (false) { ?>
<br>1.28
<?php } ?>

</a>

<?php
// Variables given by sphinx
$chplTitle = "1.28";
$pagename = "developer/bestPractices/NightlyTesting";
include "../..//versionButton.php";
?>


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
              <p class="caption" role="heading"><span class="caption-text">Compiling and Running Chapel</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../usingchapel/QUICKSTART.html">Quickstart Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usingchapel/index.html">Using Chapel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../platforms/index.html">Platform-Specific Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../technotes/index.html">Technical Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Tools</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Docs for Contributors</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Best Practices for Contributors</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="GettingStarted.html">Getting Started</a></li>
<li class="toctree-l3"><a class="reference internal" href="ContributorInfo.html">Contributor Info</a></li>
<li class="toctree-l3"><a class="reference internal" href="DCO.html">Getting started with Chapel and the Developer Certificate of Origin (DCO)</a></li>
<li class="toctree-l3"><a class="reference internal" href="CompilerDebugging.html">Tips On Debugging The Compiler</a></li>
<li class="toctree-l3"><a class="reference internal" href="CompilerIRTricks.html">Examining/Debugging Compiler IR</a></li>
<li class="toctree-l3"><a class="reference internal" href="ErrorWarningMessaging.html">How To Generate Warnings And Error Messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="RuntimeLibrary.html">The Chapel Runtime Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="GeneratedCode.html">All About Compiler-Generated Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="GASNetOnDesktops.html">Running Chapel Programs with GASNet on your Desktop</a></li>
<li class="toctree-l3"><a class="reference internal" href="git.html">Git tips for Chapel developers</a></li>
<li class="toctree-l3"><a class="reference internal" href="CHPL_DEVELOPER.html">The CHPL_DEVELOPER environment variable</a></li>
<li class="toctree-l3"><a class="reference internal" href="TestSystem.html">Chapel Testing System</a></li>
<li class="toctree-l3"><a class="reference internal" href="SpellChecking.html">chplspell</a></li>
<li class="toctree-l3"><a class="reference internal" href="Valgrind.html">Valgrind</a></li>
<li class="toctree-l3"><a class="reference internal" href="Sanitizers.html">Sanitizers</a></li>
<li class="toctree-l3"><a class="reference internal" href="Deprecation.html">Chapel’s Deprecation Policy</a></li>
<li class="toctree-l3"><a class="reference internal" href="Unstable.html">Unstable Features</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Nightly Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="StandardModuleStyle.html">Standard Module Style</a></li>
<li class="toctree-l3"><a class="reference internal" href="TestAnnotationsLocally.html">How to test ANNOTATIONS.yaml changes locally</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildingdocs.html">Building Chapel Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="Potpourri.html">Miscellaneous Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../compiler-internals/index.html">Compiler Library API Docs</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Writing Chapel Programs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../language/reference.html">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Hello World Variants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../primers/index.html">Primers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../language/spec/index.html">Language Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../builtins/index.html">Built-in Types and Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/standard.html">Standard Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/packages.html">Package Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/layoutdist.html">Standard Layouts and Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mason-packages/index.html">Mason Packages (WIP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../users-guide/index.html">Chapel Users Guide (WIP)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Language History</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../language/evolution.html">Chapel Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../language/archivedSpecs.html">Documentation Archives</a></li>
</ul>

  <p class="caption" role="heading"><span class="caption-text">Indexes</span></p>
  <ul>
    <li class="toctree-11"><a class="reference internal" href="../../chpl-modindex.html">Chapel Module Index</a></li>
    <li class="toctree-11"><a class="reference internal" href="../../genindex.html">Complete Docs Index</a></li>
  </ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Chapel Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Docs for Contributors</a> &raquo;</li>
          <li><a href="index.html">Best Practices for Contributors</a> &raquo;</li>
      <li>Nightly Testing</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/developer/bestPractices/NightlyTesting.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="nightly-testing">
<span id="readme-nightlytesting"></span><h1>Nightly Testing<a class="headerlink" href="#nightly-testing" title="Permalink to this headline">¶</a></h1>
<p>This is intended to help get external developers running nightly testing. The
following script should be called from a cron job or something to kick off the
testing regularly. This script basically groups all the env vars you’ll need to
set into one place and handles downloading the chapel repo for testing. It then
calls our <code class="docutils literal notranslate"><span class="pre">nightly</span></code> script which runs a set of tests and mails results to a
provided list. It keeps these nightly logs so it can track new or resolved
regressions. The nightly script basically builds the compiler and runtime, runs
some tests and parses the test output to send mails. By default it will do a
correctness run, though it can also be configured to test performance, compiler
performance, memleaks, and several other configurations.</p>
<p>In the following script you’ll need to set whatever special <code class="docutils literal notranslate"><span class="pre">CHPL_*</span></code> vars are
required for your testing and at a minimum <code class="docutils literal notranslate"><span class="pre">CHPL_NIGHTLY_CRON_RECIPIENT</span></code> and
<code class="docutils literal notranslate"><span class="pre">CHPL_NIGHTLY_TEST_CONFIG_NAME</span></code>. There are additional configuration variables
that can be set, but they have pretty sane defaults so they can probably be
left alone.</p>
<p>To test this script without running the entire test suite, you can simply run
this script with <code class="docutils literal notranslate"><span class="pre">-hellos</span></code>. i.e. if the script is named “test_chapel” then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">test_chapel</span> <span class="o">-</span><span class="n">hellos</span>
</pre></div>
</div>
<p>will only test the 6 hello*.chpl examples instead of the whole suite. If that
is successful the script can simply be called without any args and it will do a
correctness test on the entire chapel test suite:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">test_chapel</span>
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

<span class="c1"># This is a script to help external developers run nightly testing. It</span>
<span class="c1"># essentially downloads a copy of the chapel repo and sets some required</span>
<span class="c1"># variables and then runs our &quot;nightly&quot; script. Any arguments are passed</span>
<span class="c1"># along to the nightly script. See $CHPL_HOME/util/cron/nightly for</span>
<span class="c1"># available options.</span>


<span class="c1">#</span>
<span class="c1"># Env vars required for testing a specific config. For example:</span>
<span class="c1">#   export CHPL_TASKS=&lt;MY_AWESOME_TASKING_LAYER&gt;</span>
<span class="c1">#</span>


<span class="c1">#</span>
<span class="c1"># Config vars that need to be set</span>
<span class="c1">#</span>

<span class="c1"># Change to appropriate mailing list or email</span>
<span class="nb">export</span> <span class="nv">CHPL_NIGHTLY_CRON_RECIPIENT</span><span class="o">=</span>email.example.com

<span class="c1"># Config name used in mail and log file names</span>
<span class="nb">export</span> <span class="nv">CHPL_NIGHTLY_TEST_CONFIG_NAME</span><span class="o">=</span><span class="s2">&quot;chapel.test&quot;</span>


<span class="c1">#</span>
<span class="c1"># Config vars with probably safe defaults</span>
<span class="c1">#</span>

<span class="c1"># Used to store permanent log files (and to diff runs night to night)</span>
<span class="nb">export</span> <span class="nv">CHPL_NIGHTLY_LOG_PREFIX</span><span class="o">=</span>~/chapel_logs/

<span class="c1"># Used to explicitly set a tmp dir. This is where chapel is downloaded</span>
<span class="c1"># to and tested from. Defaults to $TMPDIR if set, otherwise /tmp</span>
<span class="nb">export</span> <span class="nv">CHPL_NIGHTLY_TMPDIR</span><span class="o">=</span>

<span class="c1"># Used to select which git repo and branch to clone</span>
<span class="nb">export</span> <span class="nv">CHPL_NIGHTLY_GIT_URL</span><span class="o">=</span><span class="s2">&quot;https://github.com/chapel-lang/chapel.git&quot;</span>
<span class="nb">export</span> <span class="nv">CHPL_NIGHTLY_GIT_BRANCH</span><span class="o">=</span><span class="s2">&quot;main&quot;</span>


<span class="c1">#</span>
<span class="c1"># helper logging routines</span>
<span class="c1">#</span>

<span class="k">function</span> log_fatal<span class="o">()</span> <span class="o">{</span>
    <span class="nb">local</span> <span class="nv">msg</span><span class="o">=</span><span class="nv">$@</span>
    <span class="nb">echo</span> <span class="s2">&quot;[FATAL] </span><span class="si">${</span><span class="nv">msg</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="nb">exit</span> <span class="m">1</span>
<span class="o">}</span>

<span class="k">function</span> log_info<span class="o">()</span> <span class="o">{</span>
    <span class="nb">local</span> <span class="nv">msg</span><span class="o">=</span><span class="nv">$@</span>
    <span class="nb">echo</span> <span class="s2">&quot;[INFO] </span><span class="si">${</span><span class="nv">msg</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="o">}</span>


<span class="c1">#</span>
<span class="c1"># ensure that git is available</span>
<span class="c1">#</span>

git --version <span class="p">&amp;</span>&gt;/dev/null
<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  log_info <span class="s2">&quot;git is installed&quot;</span>
<span class="k">else</span>
  log_fatal <span class="s2">&quot;git is required to use this script&quot;</span>
<span class="k">fi</span>


<span class="c1">#</span>
<span class="c1"># download the chapel repo if it does not exist, otherwise just clean</span>
<span class="c1"># the existing one and get it up to date</span>
<span class="c1">#</span>

<span class="nv">tmp_dir</span><span class="o">=</span><span class="si">${</span><span class="nv">CHPL_NIGHTLY_TMPDIR</span><span class="k">:-</span><span class="si">${</span><span class="nv">TMPDIR</span><span class="k">:-</span><span class="p">/tmp</span><span class="si">}}</span>
<span class="nb">export</span> <span class="nv">CHPL_NIGHTLY_TMPDIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$tmp_dir</span><span class="s2">&quot;</span>
<span class="nv">chapel_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$tmp_dir</span><span class="s2">/chapel&quot;</span>

<span class="k">if</span> <span class="o">[</span> -d <span class="s2">&quot;</span><span class="nv">$chapel_dir</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  log_info <span class="s2">&quot;chapel dir exists at </span><span class="nv">$chapel_dir</span><span class="s2">, cleaning repo and then pulling updated sources&quot;</span>
  <span class="nb">cd</span> <span class="s2">&quot;</span><span class="nv">$chapel_dir</span><span class="s2">&quot;</span>
  git clean -fdx . <span class="o">&amp;&amp;</span> git pull
  <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    log_info <span class="s2">&quot;Successfully cleaned and updated sources&quot;</span>
  <span class="k">else</span>
    log_fatal <span class="s2">&quot;Failed to clean and update sources&quot;</span>
  <span class="k">fi</span>
<span class="k">else</span>
  log_info <span class="s2">&quot;chapel dir does NOT exist at </span><span class="nv">$chapel_dir</span><span class="s2">, cloning a copy of the repo&quot;</span>
  git clone --branch <span class="s2">&quot;</span><span class="nv">$CHPL_NIGHTLY_GIT_BRANCH</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="nv">$CHPL_NIGHTLY_GIT_URL</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="nv">$chapel_dir</span><span class="s2">&quot;</span>
  <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    log_info <span class="s2">&quot;Successfully cloned repo&quot;</span>
  <span class="k">else</span>
    log_fatal <span class="s2">&quot;Failed to clone repo&quot;</span>
  <span class="k">fi</span>
<span class="k">fi</span>


<span class="c1">#</span>
<span class="c1"># Let&#39;s do some testing!</span>
<span class="c1">#</span>

<span class="c1"># setup chpl_home and stuff</span>
<span class="nb">source</span> <span class="s2">&quot;</span><span class="nv">$chapel_dir</span><span class="s2">/util/setchplenv.bash&quot;</span>

<span class="c1"># source the common nightly testing script to get common vars</span>
<span class="nb">cd</span> <span class="s2">&quot;</span><span class="nv">$chapel_dir</span><span class="s2">/util/cron&quot;</span>
<span class="nb">source</span> common.bash

<span class="c1"># Call our nightly script forwarding any args passed into this script</span>
<span class="nv">$CWD</span>/nightly -cron <span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Unstable.html" class="btn btn-neutral float-left" title="Unstable Features" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="StandardModuleStyle.html" class="btn btn-neutral float-right" title="Standard Module Style" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Hewlett Packard Enterprise Development LP.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 



</body>
</html>